<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Bitcoin Pulse - Live BTC Market Data & Analysis</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Live Bitcoin price, market analysis, on-chain metrics, and sentiment data. Track BTC price movements, Fear & Greed Index, hash rate, and network statistics in real-time.">
    <meta name="keywords" content="Bitcoin, BTC, cryptocurrency, price tracker, market analysis, Fear and Greed Index, hash rate, blockchain, on-chain metrics">
    <meta name="author" content="The Bitcoin Pulse">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thebitcoinpulse.com/">
    <meta property="og:title" content="The Bitcoin Pulse - Live BTC Market Data & Analysis">
    <meta property="og:description" content="Live Bitcoin price, market analysis, on-chain metrics, and sentiment data. Track BTC in real-time.">
    <meta property="og:image" content="https://thebitcoinpulse.com/og-image.png">
    <meta property="og:site_name" content="The Bitcoin Pulse">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://thebitcoinpulse.com/">
    <meta name="twitter:title" content="The Bitcoin Pulse - Live BTC Market Data">
    <meta name="twitter:description" content="Live Bitcoin price, market analysis, on-chain metrics, and sentiment data.">
    <meta name="twitter:image" content="https://thebitcoinpulse.com/og-image.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://thebitcoinpulse.com/">

    <!-- Favicon (placeholder) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#8383;</text></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK for community features -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-dark: #0d1117;
            --bg-darker: #010409;
            --bg-card: #161b22;
            --bg-card-hover: #1c2128;
            --border-color: #30363d;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent: #f6851b;
            --accent-light: #ff9f43;
            --green: #3fb950;
            --red: #f85149;
            --blue: #58a6ff;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-darker);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* Hero gradient background */
        .hero-bg {
            background: linear-gradient(180deg, #0d1117 0%, #010409 100%);
            position: relative;
            overflow: hidden;
        }

        .hero-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150%;
            height: 600px;
            background: radial-gradient(ellipse at center top, rgba(246, 133, 27, 0.15) 0%, transparent 60%);
            pointer-events: none;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
            position: relative;
        }

        /* Navigation */
        .nav {
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo-text {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .nav-date {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Hero Section */
        .hero {
            padding: 80px 0 60px;
            text-align: center;
        }

        .hero-label {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(246, 133, 27, 0.1);
            border: 1px solid rgba(246, 133, 27, 0.3);
            border-radius: 20px;
            color: var(--accent);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 24px;
        }

        .hero-price {
            font-size: 5rem;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            margin: 0 0 16px 0;
        }

        .price-currency {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--text-muted);
            margin-left: 8px;
            vertical-align: middle;
        }

        .hero-change {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(248, 81, 73, 0.1);
            border-radius: 8px;
            color: #ef4444;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .hero-change svg {
            width: 20px;
            height: 20px;
        }

        /* Stats Row */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            margin: 40px 0;
        }

        .stat-item {
            background: var(--bg-card);
            padding: 24px;
            text-align: center;
        }

        .stat-item:hover {
            background: var(--bg-card-hover);
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-value.green { color: var(--green); }
        .stat-value.red { color: var(--red); }

        /* Price Chart */
        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0 40px;
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .chart-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-timeframes {
            display: flex;
            gap: 8px;
        }

        .timeframe-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .timeframe-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .timeframe-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* MA Legend */
        .ma-legend {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .ma-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .ma-legend-line {
            width: 20px;
            height: 2px;
            border-radius: 1px;
        }

        .ma-toggle {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }

        .ma-toggle-btn {
            padding: 4px 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: transparent;
            color: var(--text-muted);
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .ma-toggle-btn.active {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--text-secondary);
            color: var(--text-primary);
        }

        .chart-wrapper {
            height: 300px;
            position: relative;
        }

        .chart-stats {
            display: flex;
            gap: 24px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .chart-stat {
            text-align: center;
        }

        .chart-stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .chart-stat-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 4px;
        }

        /* Live indicator */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.7rem;
            color: var(--green);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Main Content */
        .main-content {
            background: var(--bg-dark);
            padding: 60px 0;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            transition: border-color 0.2s ease;
        }

        .card:hover {
            border-color: var(--text-muted);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: rgba(246, 133, 27, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            font-size: 18px;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        /* Fear & Greed */
        .fg-container {
            text-align: center;
            padding: 20px 0;
        }

        .fg-value {
            font-size: 4rem;
            font-weight: 800;
            color: #ef4444;
            line-height: 1;
        }

        .fg-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ef4444;
            margin-top: 8px;
        }

        .fg-bar {
            height: 8px;
            background: linear-gradient(90deg, #f85149, #f97316, #eab308, #84cc16, #3fb950);
            border-radius: 4px;
            margin: 20px 0 8px;
            position: relative;
        }

        .fg-indicator {
            position: absolute;
            top: -4px;
            left: 14%;
            transform: translateX(-50%);
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .fg-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* Data Rows */
        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .data-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .data-value.accent {
            color: var(--accent);
        }

        /* Historical Table */
        .history-table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            min-width: 280px;
        }

        .history-table thead {
            background: var(--bg-darker);
        }

        .history-table th {
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-color);
        }

        .history-table th:last-child {
            text-align: right;
        }

        .history-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .history-table tr:last-child td {
            border-bottom: none;
        }

        .history-table tr:hover {
            background: var(--bg-card-hover);
        }

        .history-year-cell {
            font-weight: 600;
            color: var(--text-primary);
        }

        .history-price-cell {
            font-weight: 700;
            color: var(--accent);
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        }

        .history-change-cell {
            text-align: right;
            font-weight: 500;
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        }

        /* Section Headers */
        .section-header {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 8px 0;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Mini Stats Grid */
        .mini-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }

        .mini-stat {
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .mini-stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .mini-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-top: 4px;
        }

        /* Info Icons and Tooltips */
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            font-size: 10px;
            font-weight: 700;
            font-style: normal;
            color: var(--text-muted);
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            margin-left: 6px;
            cursor: help;
            transition: all 0.2s ease;
            vertical-align: middle;
        }

        .info-icon:hover {
            color: var(--accent);
            border-color: var(--accent);
            background: rgba(246, 133, 27, 0.1);
        }

        /* Desktop Tooltip */
        .tooltip-container {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            width: 280px;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            pointer-events: none;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--border-color);
        }

        .tooltip-container:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .tooltip-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .tooltip-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .tooltip-why {
            font-size: 0.7rem;
            color: var(--accent);
            font-style: italic;
        }

        /* Glossary Modal */
        .glossary-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .glossary-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .glossary-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .glossary-overlay.active .glossary-modal {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .glossary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .glossary-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .glossary-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .glossary-close:hover {
            background: var(--bg-darker);
            color: var(--text-primary);
        }

        .glossary-search {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .glossary-search input {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .glossary-search input::placeholder {
            color: var(--text-muted);
        }

        .glossary-search input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .glossary-filters {
            display: flex;
            gap: 8px;
            padding: 12px 24px;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .filter-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .glossary-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px 24px;
        }

        .glossary-item {
            padding: 16px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .glossary-item:hover {
            border-color: var(--accent);
        }

        .glossary-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .glossary-item-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .glossary-item-category {
            font-size: 0.65rem;
            padding: 3px 8px;
            background: rgba(246, 133, 27, 0.1);
            border-radius: 10px;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .glossary-item-short {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 8px;
        }

        .glossary-item-full {
            color: var(--text-secondary);
            font-size: 0.8rem;
            line-height: 1.6;
            display: none;
        }

        .glossary-item.expanded .glossary-item-full {
            display: block;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }

        .glossary-item-why {
            color: var(--accent);
            font-size: 0.75rem;
            font-style: italic;
            margin-top: 8px;
        }

        /* Mobile Bottom Sheet */
        @media (max-width: 768px) {
            .tooltip {
                display: none !important;
            }

            .glossary-modal {
                top: auto;
                bottom: 0;
                left: 0;
                right: 0;
                transform: translateY(100%);
                width: 100%;
                max-width: none;
                max-height: 85vh;
                border-radius: 16px 16px 0 0;
            }

            .glossary-overlay.active .glossary-modal {
                transform: translateY(0);
            }

            .glossary-filters {
                padding: 12px 16px;
            }

            .glossary-content {
                padding: 12px 16px;
            }
        }

        /* Nav Learn Link */
        .nav-links {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-link {
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-decoration: none;
            transition: color 0.2s ease;
            cursor: pointer;
        }

        .nav-link:hover {
            color: var(--accent);
        }

        /* Currency Selector */
        .currency-selector {
            position: relative;
        }

        .currency-btn {
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 6px 10px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .currency-btn:hover {
            border-color: var(--accent);
            color: var(--text-primary);
        }

        .currency-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 0;
            min-width: 120px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s;
            z-index: 100;
        }

        .currency-selector.open .currency-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .currency-option {
            padding: 8px 16px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .currency-option:hover {
            background: var(--bg-darker);
            color: var(--text-primary);
        }

        .currency-option.active {
            color: var(--accent);
        }

        .currency-flag {
            font-size: 1rem;
        }

        /* Today's Pulse Summary */
        .pulse-summary {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px 24px;
            margin: 20px 0;
            text-align: center;
        }

        .pulse-summary-text {
            font-size: 1.05rem;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .pulse-summary-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        /* Market Conditions Score */
        .market-score-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
        }

        .market-score-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .market-score-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .market-score-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .market-score-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .market-score-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .score-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: var(--bg-darker);
            border-radius: 8px;
            font-size: 0.8rem;
        }

        .score-check {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            flex-shrink: 0;
        }

        .score-check.active {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .score-check.inactive {
            background: rgba(156, 163, 175, 0.2);
            color: var(--text-muted);
        }

        .score-item-label {
            color: var(--text-secondary);
        }

        .score-item-value {
            margin-left: auto;
            color: var(--text-muted);
            font-size: 0.7rem;
        }

        .market-score-disclaimer {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-align: center;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            font-style: italic;
        }

        /* Yesterday vs Today Comparison */
        .comparison-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
        }

        .comparison-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 16px 0;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-darker);
            border-radius: 8px;
            overflow: hidden;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px 16px;
            text-align: center;
        }

        .comparison-table th {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            font-weight: 600;
            background: var(--bg-darker);
        }

        .comparison-table td {
            font-size: 0.9rem;
            color: var(--text-primary);
            border-top: 1px solid var(--border-color);
        }

        .comparison-table .metric-name {
            text-align: left;
            font-weight: 500;
        }

        .comparison-table .delta {
            font-weight: 600;
        }

        .comparison-table .delta.positive {
            color: var(--green);
        }

        .comparison-table .delta.negative {
            color: var(--red);
        }

        .comparison-table .delta.neutral {
            color: var(--text-muted);
        }

        /* What Changed Today */
        .changes-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
        }

        .changes-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 16px 0;
        }

        .changes-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .changes-list li {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .changes-list li:last-child {
            border-bottom: none;
        }

        .change-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .change-icon.up {
            background: rgba(34, 197, 94, 0.2);
            color: var(--green);
        }

        .change-icon.down {
            background: rgba(239, 68, 68, 0.2);
            color: var(--red);
        }

        .change-icon.neutral {
            background: rgba(156, 163, 175, 0.2);
            color: var(--text-muted);
        }

        /* Education Drawer */
        .education-drawer {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            margin: 20px 0;
            overflow: hidden;
        }

        .education-toggle {
            width: 100%;
            padding: 16px 20px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s;
        }

        .education-toggle:hover {
            background: var(--bg-card-hover);
        }

        .education-toggle-icon {
            transition: transform 0.3s;
        }

        .education-drawer.open .education-toggle-icon {
            transform: rotate(180deg);
        }

        .education-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .education-drawer.open .education-content {
            max-height: 600px;
        }

        .education-inner {
            padding: 0 20px 20px;
        }

        .education-section {
            margin-bottom: 20px;
        }

        .education-section:last-child {
            margin-bottom: 0;
        }

        .education-section h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 8px 0;
        }

        .education-section p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin: 0;
        }

        /* Roadmap Footer */
        .roadmap-footer {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .roadmap-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 12px 0;
        }

        .roadmap-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .roadmap-list li {
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Halving Countdown Widget */
        .halving-widget {
            background: linear-gradient(135deg, rgba(246, 133, 27, 0.1) 0%, rgba(246, 133, 27, 0.05) 100%);
            border: 1px solid rgba(246, 133, 27, 0.3);
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
            text-align: center;
        }

        .halving-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 16px;
            font-weight: 600;
        }

        .halving-countdown {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .countdown-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 20px;
            min-width: 80px;
        }

        .countdown-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1;
        }

        .countdown-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 6px;
        }

        .halving-progress {
            margin: 20px 0;
        }

        .halving-progress-bar {
            height: 8px;
            background: var(--bg-darker);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .halving-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-light));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .halving-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .halving-info {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .halving-info-item {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .halving-info-item strong {
            color: var(--text-primary);
        }

        /* Share Button */
        .share-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .share-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .share-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 0;
            min-width: 160px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
        }

        .share-dropdown.active {
            display: block;
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .share-option:hover {
            background: var(--bg-darker);
            color: var(--text-primary);
        }

        .share-container {
            position: relative;
        }

        .share-toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-card);
            border: 1px solid var(--green);
            color: var(--green);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.85rem;
            z-index: 10000;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .share-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* News Feed */
        .news-feed {
            margin-top: 40px;
        }

        .news-grid {
            display: grid;
            gap: 16px;
        }

        .news-item {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .news-item:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .news-content {
            flex: 1;
        }

        .news-source {
            font-size: 0.7rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 6px;
        }

        .news-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 6px;
        }

        .news-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .news-loading {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .halving-countdown {
                gap: 10px;
            }
            .countdown-item {
                padding: 12px 16px;
                min-width: 65px;
            }
            .countdown-value {
                font-size: 1.5rem;
            }
            .halving-info {
                gap: 12px;
            }
        }

        /* Market Signals Card */
        .signals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .signal-item {
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .signal-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.03em;
            margin-bottom: 6px;
        }

        .signal-value {
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .signal-value.bullish, .signal-value.rising, .signal-value.high, .signal-value.strong {
            color: var(--green);
        }

        .signal-value.bearish, .signal-value.falling, .signal-value.low, .signal-value.weak {
            color: var(--red);
        }

        .signal-value.neutral, .signal-value.normal, .signal-value.stable, .signal-value.moderate, .signal-value.clear {
            color: var(--text-secondary);
        }

        .signal-icon {
            font-size: 1rem;
        }

        .signals-disclaimer {
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            font-size: 0.7rem;
            color: var(--text-muted);
            text-align: center;
            font-style: italic;
        }

        /* Trend Arrows */
        .trend-arrow {
            font-size: 0.85rem;
            font-weight: 700;
            margin-left: 4px;
        }

        .trend-arrow.up {
            color: var(--green);
        }

        .trend-arrow.down {
            color: var(--red);
        }

        .trend-arrow.neutral {
            color: var(--text-muted);
        }

        /* Sparklines */
        .sparkline {
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
        }

        .sparkline-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Lazy Load Chart Skeleton */
        .chart-skeleton {
            background: linear-gradient(90deg, var(--bg-darker) 25%, var(--bg-card-hover) 50%, var(--bg-darker) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
            height: 100%;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Footer */
        footer {
            background: var(--bg-darker);
            border-top: 1px solid var(--border-color);
            padding: 40px 0;
            text-align: center;
        }

        .footer-text {
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .footer-links {
            margin-top: 12px;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        /* Spacing utilities */
        .mt-24 { margin-top: 24px; }
        .mt-40 { margin-top: 40px; }
        .mb-24 { margin-bottom: 24px; }

        /* Tablet */
        @media (max-width: 1024px) {
            .grid-2 { grid-template-columns: 1fr; }
            .grid-3 { grid-template-columns: 1fr; }
            .mini-stats { grid-template-columns: repeat(3, 1fr); }
        }

        /* Mobile landscape / small tablet */
        @media (max-width: 768px) {
            .container { padding: 0 16px; }

            .hero { padding: 40px 0 30px; }
            .hero-price { font-size: 2.5rem; }
            .hero-change { font-size: 0.95rem; padding: 6px 12px; }
            .hero-label { font-size: 0.65rem; margin-bottom: 16px; }

            .stats-row {
                grid-template-columns: repeat(2, 1fr);
                margin: 24px 0;
            }
            .stat-item { padding: 16px 12px; }
            .stat-label { font-size: 0.65rem; }
            .stat-value { font-size: 1.2rem; }

            .chart-container { padding: 16px; margin: 16px 0 24px; }
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            .chart-header > div {
                width: 100%;
                justify-content: space-between;
            }
            .chart-timeframes {
                width: 100%;
                justify-content: flex-start;
            }
            .ma-toggle {
                width: 100%;
                justify-content: flex-start;
                margin-bottom: 8px;
            }
            .chart-wrapper { height: 250px; }
            .chart-stats {
                flex-wrap: wrap;
                gap: 12px;
            }
            .chart-stat {
                flex: 1 1 40%;
                min-width: 80px;
            }

            .card { padding: 16px; }
            .card-header { margin-bottom: 12px; padding-bottom: 12px; }
            .card-icon { width: 32px; height: 32px; font-size: 14px; }
            .card-title { font-size: 0.9rem; }
            .data-row { padding: 10px 0; }
            .data-label { font-size: 0.8rem; }
            .data-value { font-size: 0.85rem; }

            .section-header { margin-bottom: 16px; }
            .section-title { font-size: 1.2rem; }
            .section-subtitle { font-size: 0.85rem; }

            .mini-stats { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .mini-stat { padding: 12px; }
            .mini-stat-label { font-size: 0.6rem; }
            .mini-stat-value { font-size: 1rem; }

            .history-table { font-size: 0.85rem; }
            .history-table th, .history-table td { padding: 10px 12px; }

            .ma-legend { gap: 10px; }
            .ma-legend-item { font-size: 0.65rem; }

            .nav-date { font-size: 0.75rem; }
            .logo-text { font-size: 0.95rem; }
            .logo-icon { width: 30px; height: 30px; font-size: 16px; }

            /* Market score mobile */
            .market-score-card { padding: 16px; margin: 16px 0; }
            .market-score-header { flex-direction: column; align-items: flex-start; gap: 12px; }
            .market-score-title { font-size: 1rem; }
            .market-score-badge { font-size: 0.8rem; }
            .market-score-value { font-size: 1.2rem; }
            .market-score-details { grid-template-columns: 1fr; gap: 8px; }
            .score-item { padding: 8px 10px; font-size: 0.75rem; }
            .score-check { width: 18px; height: 18px; font-size: 0.65rem; }
            .market-score-disclaimer { font-size: 0.65rem; }

            /* Comparison table mobile */
            .comparison-card { padding: 16px; margin: 16px 0; }
            .comparison-title { font-size: 1rem; margin-bottom: 12px; }
            .comparison-table th,
            .comparison-table td {
                padding: 10px 8px;
                font-size: 0.75rem;
            }
            .comparison-table th { font-size: 0.6rem; }
            .comparison-table .metric-name { font-size: 0.8rem; }

            /* Changes card mobile */
            .changes-card { padding: 16px; margin: 16px 0; }
            .changes-title { font-size: 1rem; }
            .changes-list li { padding: 8px 0; font-size: 0.8rem; }
            .change-icon { width: 20px; height: 20px; font-size: 0.7rem; }

            /* Education drawer mobile */
            .education-drawer { margin: 16px 0; }
            .education-toggle { padding: 14px 16px; font-size: 0.9rem; }
            .education-inner { padding: 0 16px 16px; }
            .education-section h4 { font-size: 0.85rem; }
            .education-section p { font-size: 0.8rem; }

            /* Currency selector mobile */
            .currency-btn { padding: 5px 8px; font-size: 0.75rem; }
            .currency-dropdown { min-width: 100px; }
            .currency-option { padding: 6px 12px; font-size: 0.75rem; }

            /* Share section mobile */

            /* Roadmap mobile */
            .roadmap-footer { padding: 16px; margin: 16px 0; }
            .roadmap-list li { font-size: 0.7rem; padding: 5px 10px; }

            /* Glossary mobile improvements */
            .glossary-header { padding: 16px; }
            .glossary-title { font-size: 1.1rem; }
            .glossary-search { font-size: 0.9rem; padding: 10px 12px; }
            .glossary-filter-btn { font-size: 0.7rem; padding: 6px 10px; }
            .glossary-item { padding: 12px 0; }
            .glossary-item-header h3 { font-size: 0.9rem; }
            .glossary-item-description { font-size: 0.8rem; }
            .glossary-item-detail { font-size: 0.75rem; }

            footer { padding: 24px 0; }
            .footer-text { font-size: 0.8rem; }
            .footer-links { font-size: 0.7rem; }
        }

        /* Mobile portrait */
        @media (max-width: 480px) {
            .container { padding: 0 12px; }

            .hero { padding: 30px 0 20px; }
            .hero-price { font-size: 2rem; }
            .hero-change { font-size: 0.85rem; }

            .stats-row {
                grid-template-columns: 1fr 1fr;
                gap: 1px;
            }
            .stat-item { padding: 12px 8px; }
            .stat-label { font-size: 0.6rem; }
            .stat-value { font-size: 1rem; }

            .chart-container { padding: 12px; }
            .chart-wrapper { height: 200px; }
            .timeframe-btn { padding: 5px 8px; font-size: 0.65rem; }
            .ma-toggle-btn { padding: 3px 6px; font-size: 0.6rem; }
            .chart-stat-label { font-size: 0.6rem; }
            .chart-stat-value { font-size: 0.85rem; }

            .mini-stats { grid-template-columns: repeat(2, 1fr); }

            .history-table { font-size: 0.8rem; }
            .history-table th, .history-table td { padding: 8px; }
            .history-year-cell { font-size: 0.85rem; }
            .history-price-cell { font-size: 0.85rem; }
            .history-change-cell { font-size: 0.75rem; }

            .data-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
            .data-label { font-size: 0.75rem; }
            .data-value { font-size: 0.9rem; }

            .fg-value { font-size: 3rem; }
            .fg-label { font-size: 0.95rem; }

            .logo-text { display: none; }
            .nav-date { font-size: 0.7rem; }
        }

        /* Very small screens */
        @media (max-width: 360px) {
            .hero-price { font-size: 1.75rem; }
            .stat-value { font-size: 0.9rem; }
            .chart-timeframes { gap: 4px; }
            .timeframe-btn { padding: 4px 6px; }
        }

        /* Community Section */
        .community-section {
            margin-top: 40px;
        }

        .community-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        /* Daily Poll */
        .poll-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
        }

        .poll-question {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .poll-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .poll-option {
            position: relative;
            background: var(--bg-darker);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 14px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .poll-option:hover:not(.voted) {
            border-color: var(--accent);
        }

        .poll-option.selected {
            border-color: var(--accent);
            background: rgba(246, 133, 27, 0.1);
        }

        .poll-option.voted {
            cursor: default;
        }

        .poll-option-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: rgba(246, 133, 27, 0.15);
            transition: width 0.5s ease;
            z-index: 0;
        }

        .poll-option-content {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .poll-option-text {
            font-weight: 500;
            color: var(--text-primary);
        }

        .poll-option-pct {
            font-weight: 600;
            color: var(--accent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .poll-option.voted .poll-option-pct {
            opacity: 1;
        }

        .poll-total {
            text-align: center;
            margin-top: 16px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Sentiment Widget */
        .sentiment-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
        }

        .sentiment-question {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .sentiment-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .sentiment-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px 32px;
            background: var(--bg-darker);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sentiment-btn:hover:not(.voted) {
            transform: translateY(-2px);
        }

        .sentiment-btn.bullish:hover:not(.voted),
        .sentiment-btn.bullish.selected {
            border-color: var(--green);
            background: rgba(34, 197, 94, 0.1);
        }

        .sentiment-btn.bearish:hover:not(.voted),
        .sentiment-btn.bearish.selected {
            border-color: var(--red);
            background: rgba(239, 68, 68, 0.1);
        }

        .sentiment-btn.voted {
            cursor: default;
        }

        .sentiment-icon {
            font-size: 2rem;
        }

        .sentiment-label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .sentiment-bar-container {
            background: var(--bg-darker);
            border-radius: 20px;
            height: 32px;
            overflow: hidden;
            display: flex;
        }

        .sentiment-bar-bull {
            background: linear-gradient(90deg, var(--green), #4ade80);
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding-left: 12px;
            transition: width 0.5s ease;
        }

        .sentiment-bar-bear {
            background: linear-gradient(90deg, #f87171, var(--red));
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 12px;
            transition: width 0.5s ease;
        }

        .sentiment-bar-pct {
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .sentiment-total {
            text-align: center;
            margin-top: 12px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 32px;
        }

        .comments-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
        }

        .comments-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .comments-icon {
            font-size: 1.5rem;
        }

        .comments-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .comment-form {
            margin-bottom: 24px;
        }

        .comment-input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .comment-name-input {
            flex: 1;
            padding: 12px 16px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .comment-name-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .comment-textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px 16px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 12px;
        }

        .comment-textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .comment-submit {
            padding: 10px 24px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .comment-submit:hover {
            opacity: 0.9;
        }

        .comment-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .comment-item {
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
        }

        .comment-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .comment-author {
            font-weight: 600;
            color: var(--accent);
        }

        .comment-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .comment-text {
            color: var(--text-primary);
            line-height: 1.5;
        }

        .comments-empty {
            text-align: center;
            padding: 24px;
            color: var(--text-muted);
        }

        .comments-loading {
            text-align: center;
            padding: 24px;
            color: var(--text-muted);
        }

        .firebase-setup-notice {
            background: rgba(246, 133, 27, 0.1);
            border: 1px solid var(--accent);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            color: var(--text-primary);
        }

        .firebase-setup-notice a {
            color: var(--accent);
        }

        @media (max-width: 768px) {
            .community-grid {
                grid-template-columns: 1fr;
            }
            .sentiment-btn {
                padding: 16px 24px;
            }
            .sentiment-icon {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero-bg">
        <nav class="nav">
            <div class="container">
                <div class="nav-content">
                    <a href="#" class="logo">
                        <div class="logo-icon">&#8383;</div>
                        <span class="logo-text">The Bitcoin Pulse</span>
                    </a>
                    <div class="nav-links">
                        <div class="currency-selector" id="currency-selector">
                            <button class="currency-btn" id="currency-btn">
                                <span id="currency-display">USD</span>
                                <span></span>
                            </button>
                            <div class="currency-dropdown" id="currency-dropdown">
                                <div class="currency-option active" data-currency="USD" data-symbol="$" data-rate="1">
                                    <span class="currency-flag"></span> USD
                                </div>
                                <div class="currency-option" data-currency="EUR" data-symbol="" data-rate="0.92">
                                    <span class="currency-flag"></span> EUR
                                </div>
                                <div class="currency-option" data-currency="GBP" data-symbol="" data-rate="0.79">
                                    <span class="currency-flag"></span> GBP
                                </div>
                                <div class="currency-option" data-currency="JPY" data-symbol="" data-rate="149.5">
                                    <span class="currency-flag"></span> JPY
                                </div>
                                <div class="currency-option" data-currency="AUD" data-symbol="A$" data-rate="1.53">
                                    <span class="currency-flag"></span> AUD
                                </div>
                                <div class="currency-option" data-currency="CAD" data-symbol="C$" data-rate="1.36">
                                    <span class="currency-flag"></span> CAD
                                </div>
                                <div class="currency-option" data-currency="INR" data-symbol="" data-rate="83.1">
                                    <span class="currency-flag"></span> INR
                                </div>
                            </div>
                        </div>
                        <span class="nav-link" id="open-glossary">Learn</span>
                        <div class="share-container">
                            <button class="share-btn" id="share-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/>
                                </svg>
                                Share
                            </button>
                            <div class="share-dropdown" id="share-dropdown">
                                <div class="share-option" data-action="copy">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                    Copy Link
                                </div>
                                <div class="share-option" data-action="twitter">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                    Share on X
                                </div>
                            </div>
                        </div>
                        <span class="nav-date">February 04, 2026</span>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container">
            <!-- 1. Live Bitcoin Price -->
            <section class="hero">
                <span class="hero-label">Live Market Data</span>
                <h1 class="hero-price">$72,938</h1>
                <div class="hero-change">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d='M6 9l6 6 6-6'/>
                    </svg>
                    -4.25% (24h)
                </div>
            </section>

            <!-- 2. Today's Pulse -->
            <div class="pulse-summary">
                <div class="pulse-summary-label">Today's Pulse</div>
                <div class="pulse-summary-text">Bitcoin is down 4.3% today. Sentiment is in extreme fear. 798 days remain until the halving. Network activity is steady.</div>
            </div>

            <!-- 3. Market Conditions Score -->
            <div class="market-score-card">
                <div class="market-score-header">
                    <h3 class="market-score-title">Market Conditions</h3>
                    <div class="market-score-badge" style="background: #22c55e20; color: #22c55e;">
                        <span class="market-score-value">4/5</span>
                        <span>Historically Favorable</span>
                    </div>
                </div>
                <div class="market-score-details">
                    <div class="score-item">
                        <span class="score-check active"></span>
                        <span class="score-item-label">Extreme Fear</span>
                        <span class="score-item-value">F&G at 14</span>
                    </div><div class="score-item">
                        <span class="score-check active"></span>
                        <span class="score-item-label">Below 200D MA</span>
                        <span class="score-item-value">Price -29.4% below</span>
                    </div><div class="score-item">
                        <span class="score-check active"></span>
                        <span class="score-item-label">Below 50D MA</span>
                        <span class="score-item-value">Price -17.5% below</span>
                    </div><div class="score-item">
                        <span class="score-check active"></span>
                        <span class="score-item-label">>30% from ATH</span>
                        <span class="score-item-value">-42.1% from ATH</span>
                    </div><div class="score-item">
                        <span class="score-check inactive"></span>
                        <span class="score-item-label">Hash Rate Rising</span>
                        <span class="score-item-value">-2.6% vs 30d avg</span>
                    </div>
                </div>
                <div class="market-score-disclaimer">
                    Based on historical patterns only. Not financial advice. Past performance does not indicate future results.
                </div>
            </div>

            <!-- 4. What Changed Today -->
            <div class="changes-card">
                <h3 class="changes-title">What Changed Today</h3>
                <ul class="changes-list">
                    <li>
                        <span class="change-icon down"></span>
                        <span>Price fell 3.57% to $72,938</span>
                    </li>
                    <li>
                        <span class="change-icon down"></span>
                        <span>Sentiment declined (-3 to 14)</span>
                    </li>
                    <li>
                        <span class="change-icon neutral"></span>
                        <span>~144 blocks mined, adding ~450.0 BTC to supply</span>
                    </li>
                    <li>
                        <span class="change-icon neutral"></span>
                        <span>Total supply now 19,984,462 of 21M BTC</span>
                    </li>
                </ul>
            </div>

            <!-- 5. Yesterday vs Today -->
            <div class="comparison-card">
                <h3 class="comparison-title">Yesterday vs Today</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Yesterday</th>
                            <th>Today</th>
                            <th>Change</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="metric-name">Price</td>
                            <td>$75,639</td>
                            <td>$72,938</td>
                            <td class="delta negative">-3.57%</td>
                        </tr>
                        <tr>
                            <td class="metric-name">Fear & Greed</td>
                            <td>17</td>
                            <td>14 (Extreme Fear)</td>
                            <td class="delta negative">-3</td>
                        </tr>
                        <tr>
                            <td class="metric-name">Supply Added</td>
                            <td colspan="2" style="text-align: center;">~450.00 BTC / day</td>
                            <td class="delta neutral">+164250 BTC/year</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 6. Stats Row -->
            <div class="stats-row">
                <div class="stat-item">
                    <div class="stat-label">Market Cap</div>
                    <div class="stat-value" id="stat-market-cap" data-usd="1461658828988">$1.46T</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">24h Volume</div>
                    <div class="stat-value" id="stat-volume" data-usd="71276831893">$71.28B</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">7d Change</div>
                    <div class="stat-value red">-18.07%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">30d Change</div>
                    <div class="stat-value red">-22.62%</div>
                </div>
            </div>

            <!-- 7. Price Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <span class="chart-title">Price Chart</span>
                        <span class="live-indicator"><span class="live-dot"></span> Live</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div class="ma-toggle">
                            <button class="ma-toggle-btn active" data-ma="7">7D MA</button>
                            <button class="ma-toggle-btn active" data-ma="20">20D MA</button>
                            <button class="ma-toggle-btn" data-ma="50">50D MA</button>
                        </div>
                        <div class="chart-timeframes">
                            <button class="timeframe-btn" data-days="0.25">6H</button>
                            <button class="timeframe-btn" data-days="1">24H</button>
                            <button class="timeframe-btn active" data-days="7">7D</button>
                            <button class="timeframe-btn" data-days="30">30D</button>
                            <button class="timeframe-btn" data-days="90">90D</button>
                            <button class="timeframe-btn" data-days="365">1Y</button>
                            <button class="timeframe-btn" data-days="max">ALL</button>
                        </div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="priceChart"></canvas>
                </div>
                <div class="chart-stats">
                    <div class="chart-stat">
                        <div class="chart-stat-label">Period High</div>
                        <div class="chart-stat-value" id="chart-high">--</div>
                    </div>
                    <div class="chart-stat">
                        <div class="chart-stat-label">Period Low</div>
                        <div class="chart-stat-value" id="chart-low">--</div>
                    </div>
                    <div class="chart-stat">
                        <div class="chart-stat-label">Period Change</div>
                        <div class="chart-stat-value" id="chart-change">--</div>
                    </div>
                    <div class="chart-stat">
                        <div class="chart-stat-label">Avg Price</div>
                        <div class="chart-stat-value" id="chart-avg">--</div>
                    </div>
                </div>
                <div class="ma-legend">
                    <div class="ma-legend-item"><span class="ma-legend-line" style="background: #f6851b;"></span> Price</div>
                    <div class="ma-legend-item" id="legend-ma7"><span class="ma-legend-line" style="background: #58a6ff;"></span> 7D MA</div>
                    <div class="ma-legend-item" id="legend-ma20"><span class="ma-legend-line" style="background: #3fb950;"></span> 20D MA</div>
                    <div class="ma-legend-item" id="legend-ma50" style="display: none;"><span class="ma-legend-line" style="background: #f85149;"></span> 50D MA</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- 8. Combined Market Overview Section -->
            <div class="section-header">
                <h2 class="section-title">Market Overview</h2>
                <p class="section-subtitle">Price ranges, averages, sentiment, and trading data</p>
            </div>

            <div class="grid-3 mb-24">
                <!-- Price Range Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">&#128200;</div>
                        <h3 class="card-title">30-Day Price Range</h3>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Current Price</span>
                        <span class="data-value accent" id="price-current" data-usd="72938">$72,938.00</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">30d High</span>
                        <span class="data-value" id="price-high-30d" data-usd="97007.78078881276">$97,007.78</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">30d Low</span>
                        <span class="data-value" id="price-low-30d" data-usd="72934.45045190635">$72,934.45</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">All-Time High</span>
                        <span class="data-value" id="price-ath" data-usd="126080">$126,080</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">From ATH</span>
                        <span class="data-value" style="color: var(--red)">-42.1%</span>
                    </div>
                </div>

                <!-- Moving Averages Card -->
                <div class="card">
            <div class="card-header">
                <div class="card-icon">&#128200;</div>
                <h3 class="card-title">Moving Averages</h3>
            </div>
            <div class="data-row">
                <span class="data-label">7-Day MA</span>
                <span class="data-value" id="ma-7d" data-usd="78827.72367026296" data-pct="-7.377332237230619" style="color: var(--red)">$78,828 <small>(-7.4%)</small></span>
            </div>
            <div class="data-row">
                <span class="data-label">20-Day MA</span>
                <span class="data-value" id="ma-20d" data-usd="86381.86005503955" data-pct="-15.477230342642972" style="color: var(--red)">$86,382 <small>(-15.5%)</small></span>
            </div>
            <div class="data-row">
                <span class="data-label">50-Day MA</span>
                <span class="data-value" id="ma-50d" data-usd="88443.77081721179" data-pct="-17.447729867875715" style="color: var(--red)">$88,444 <small>(-17.4%)</small></span>
            </div>
            <div class="data-row" style="border-top: 1px solid var(--border-color); margin-top: 12px; padding-top: 12px;">
                <span class="data-label">Trend Signal</span>
                <span class="data-value" style="color: var(--red)">
                    Bearish
                </span>
            </div>
        </div>

                <!-- Fear & Greed Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">&#128161;</div>
                        <h3 class="card-title">Market Sentiment<span class="info-icon" data-metric="fear_greed" aria-label="Learn more">i</span></h3>
                    </div>
                    <div class="fg-container">
                        <div class="fg-value">14</div>
                        <div class="fg-label">Extreme Fear</div>
                        <div class="fg-bar">
                            <div class="fg-indicator"></div>
                        </div>
                        <div class="fg-labels">
                            <span>Extreme Fear</span>
                            <span>Extreme Greed</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid-2 mb-24">
                <!-- Market Dominance Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">&#127760;</div>
                        <h3 class="card-title">Market Dominance</h3>
                    </div>
                    <div class="data-row">
                        <span class="data-label">BTC Dominance<span class="info-icon" data-metric="btc_dominance" aria-label="Learn more">i</span></span>
                        <span class="data-value accent">57.1%</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Total Crypto MCap</span>
                        <span class="data-value" id="total-crypto-mcap" data-usd="2542869296809.2886">$2.54T</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">BTC Market Cap<span class="info-icon" data-metric="market_cap" aria-label="Learn more">i</span></span>
                        <span class="data-value" id="btc-market-cap" data-usd="1461658828988">$1.46T</span>
                    </div>
                </div>

                <!-- Trading Volume Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">&#128200;</div>
                        <h3 class="card-title">Trading Volume</h3>
                    </div>
                    <div class="data-row">
                        <span class="data-label">24h Volume<span class="info-icon" data-metric="volume_24h" aria-label="Learn more">i</span></span>
                        <span class="data-value accent" id="trading-volume-24h" data-usd="71276831893">$71.28B</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Volume/MCap Ratio</span>
                        <span class="data-value">4.88%</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">24h Tx Volume</span>
                        <span class="data-value" id="tx-volume-24h" data-usd="13344411909.709486">$13.34B</span>
                    </div>
                </div>
            </div>

            <!-- 9. Education Drawer -->
            <div class="education-drawer" id="education-drawer">
                <button class="education-toggle" onclick="document.getElementById('education-drawer').classList.toggle('open')">
                    <span>What am I looking at?</span>
                    <span class="education-toggle-icon"></span>
                </button>
                <div class="education-content">
                    <div class="education-inner">
                        <div class="education-section">
                            <h4>What is Bitcoin?</h4>
                            <p>Bitcoin is a decentralized digital currency that operates without a central bank or single administrator. It uses a peer-to-peer network where transactions are verified by nodes and recorded on a public ledger called a blockchain.</p>
                        </div>
                        <div class="education-section">
                            <h4>Why does the halving matter?</h4>
                            <p>Every 210,000 blocks (roughly every 4 years), the reward miners receive for adding new blocks is cut in half. This reduces the rate of new Bitcoin creation, making it increasingly scarce over time. Historically, halvings have preceded significant price movements.</p>
                        </div>
                        <div class="education-section">
                            <h4>Why is supply capped at 21 million?</h4>
                            <p>Bitcoin's creator designed a fixed supply to make it deflationary, unlike traditional currencies that can be printed indefinitely. This scarcity is enforced by the protocol itself and cannot be changed, making Bitcoin similar to digital gold.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 10. Halving Countdown Widget -->
            <div class="halving-widget">
                <div class="halving-title">Next Bitcoin Halving</div>
                <div class="halving-countdown" id="halving-countdown">
                    <div class="countdown-item">
                        <div class="countdown-value" id="countdown-days">--</div>
                        <div class="countdown-label">Days</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-value" id="countdown-hours">--</div>
                        <div class="countdown-label">Hours</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-value" id="countdown-mins">--</div>
                        <div class="countdown-label">Minutes</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-value" id="countdown-blocks">--</div>
                        <div class="countdown-label">Blocks</div>
                    </div>
                </div>
                <div class="halving-progress">
                    <div class="halving-progress-bar">
                        <div class="halving-progress-fill" id="halving-progress" style="width: 0%"></div>
                    </div>
                    <div class="halving-stats">
                        <span>Last Halving (2024)</span>
                        <span id="halving-progress-pct">0%</span>
                        <span>Next Halving (~2028-04-13)</span>
                    </div>
                </div>
                <div class="halving-info">
                    <div class="halving-info-item">Current Block: <strong>935,040</strong></div>
                    <div class="halving-info-item">Current Reward: <strong>3.125 BTC</strong></div>
                    <div class="halving-info-item">Post-Halving: <strong>1.5625 BTC</strong></div>
                </div>
            </div>

            <!-- 11. Historical Prices -->
            <div class="section-header mt-40">
                <h2 class="section-title">Bitcoin on February 04</h2>
                <p class="section-subtitle">Historical prices for this date across the years</p>
            </div>
            <div class="card mb-24">
                <div class="history-table-wrapper">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Year</th>
                                <th>Price</th>
                                <th>YoY Change</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                    <td class="history-year-cell">2025</td>
                    <td class="history-price-cell">$101,467</td>
                    <td class="history-change-cell"><span style="color: var(--green)">+137.3%</span></td>
                </tr><tr>
                    <td class="history-year-cell">2024</td>
                    <td class="history-price-cell">$42,750</td>
                    <td class="history-change-cell"><span style="color: var(--green)">+80.0%</span></td>
                </tr><tr>
                    <td class="history-year-cell">2023</td>
                    <td class="history-price-cell">$23,750</td>
                    <td class="history-change-cell"><span style="color: var(--red)">-28.6%</span></td>
                </tr><tr>
                    <td class="history-year-cell">2022</td>
                    <td class="history-price-cell">$33,250</td>
                    <td class="history-change-cell"><span style="color: var(--red)">-12.5%</span></td>
                </tr><tr>
                    <td class="history-year-cell">2021</td>
                    <td class="history-price-cell">$38,000</td>
                    <td class="history-change-cell"><span style="color: var(--green)">+344.4%</span></td>
                </tr><tr>
                    <td class="history-year-cell">2020</td>
                    <td class="history-price-cell">$8,550</td>
                    <td class="history-change-cell"><span style="color: var(--green)">+157.1%</span></td>
                </tr><tr>
                    <td class="history-year-cell">2019</td>
                    <td class="history-price-cell">$3,325</td>
                    <td class="history-change-cell"><span style="color: var(--red)">-61.1%</span></td>
                </tr><tr>
                    <td class="history-year-cell">2018</td>
                    <td class="history-price-cell">$8,550</td>
                    <td class="history-change-cell"><span style="color: var(--green)">+800.0%</span></td>
                </tr><tr>
                    <td class="history-year-cell">2017</td>
                    <td class="history-price-cell">$950</td>
                    <td class="history-change-cell"><span style="color: var(--green)">+122.5%</span></td>
                </tr><tr>
                    <td class="history-year-cell">2016</td>
                    <td class="history-price-cell">$427</td>
                    <td class="history-change-cell"><span style="color: var(--green)">+80.2%</span></td>
                </tr><tr>
                    <td class="history-year-cell">2015</td>
                    <td class="history-price-cell">$237</td>
                    <td class="history-change-cell"><span style="color: var(--red)">-50.1%</span></td>
                </tr><tr>
                    <td class="history-year-cell">2014</td>
                    <td class="history-price-cell">$475</td>
                    <td class="history-change-cell"><span style="color: var(--green)">+400.0%</span></td>
                </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Block Stats -->
            <div class="section-header mt-40">
                <h2 class="section-title">Network Statistics</h2>
                <p class="section-subtitle">On-chain metrics and block data</p>
            </div>

            <div class="grid-3 mb-24">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">&#9939;</div>
                        <h3 class="card-title">Block Info</h3>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Block Height<span class="info-icon" data-metric="block_height" aria-label="Learn more">i</span></span>
                        <span class="data-value">935,040</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Block Reward<span class="info-icon" data-metric="block_reward" aria-label="Learn more">i</span></span>
                        <span class="data-value accent">3.125 BTC</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Reward Value</span>
                        <span class="data-value">$227,931</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Avg Block Time</span>
                        <span class="data-value">9.6 min</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">&#9201;</div>
                        <h3 class="card-title">Next Halving</h3>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Blocks Until</span>
                        <span class="data-value">114,960</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Est. Date</span>
                        <span class="data-value accent">2028-04-13</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">New Reward</span>
                        <span class="data-value">1.5625 BTC</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Mempool TXs</span>
                        <span class="data-value">20,420</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">&#128176;</div>
                        <h3 class="card-title">Supply</h3>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Circulating<span class="info-icon" data-metric="circulating_supply" aria-label="Learn more">i</span></span>
                        <span class="data-value">19.98M BTC</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Remaining</span>
                        <span class="data-value accent">1.02M BTC</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">% Mined</span>
                        <span class="data-value">95.16%</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Sats per $1<span class="info-icon" data-metric="sats_per_dollar" aria-label="Learn more">i</span></span>
                        <span class="data-value">1,371</span>
                    </div>
                </div>
            </div>

            <!-- Mini Stats -->
            <div class="mini-stats">
                <div class="mini-stat">
                    <div class="mini-stat-label">Hash Rate<span class="info-icon" data-metric="hash_rate" aria-label="Learn more">i</span></div>
                    <div class="mini-stat-value">930 EH/s</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">Transactions<span class="info-icon" data-metric="tx_count" aria-label="Learn more">i</span></div>
                    <div class="mini-stat-value">435,461</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">Fee Rate<span class="info-icon" data-metric="fee_rate" aria-label="Learn more">i</span></div>
                    <div class="mini-stat-value">1 sat/vB</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">Nodes<span class="info-icon" data-metric="nodes" aria-label="Learn more">i</span></div>
                    <div class="mini-stat-value">9,756</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">Difficulty<span class="info-icon" data-metric="difficulty" aria-label="Learn more">i</span></div>
                    <div class="mini-stat-value">141.7T</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">Avg Fee</div>
                    <div class="mini-stat-value">$258289.80</div>
                </div>
            </div>

            <!-- On-Chain Analytics -->
            <div class="section-header mt-40">
                <h2 class="section-title">On-Chain Analytics</h2>
                <p class="section-subtitle">Network activity and address metrics</p>
            </div>

            <div class="grid-2 mb-24">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">&#128101;</div>
                        <h3 class="card-title">Address Activity</h3>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Active Addresses (24h)<span class="info-icon" data-metric="active_addresses" aria-label="Learn more">i</span></span>
                        <span class="data-value accent">550,746</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">7-Day Average</span>
                        <span class="data-value">522,165</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">New Addresses</span>
                        <span class="data-value">100,789,067</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Whale Txs (Recent)<span class="info-icon" data-metric="whale_transactions" aria-label="Learn more">i</span></span>
                        <span class="data-value">0</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">&#128176;</div>
                        <h3 class="card-title">Transaction Volume</h3>
                    </div>
                    <div class="data-row">
                        <span class="data-label">24h Volume (USD)</span>
                        <span class="data-value accent">$13.34B</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Daily Transactions</span>
                        <span class="data-value">435,461</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Avg Tx Fee</span>
                        <span class="data-value">$258289.80</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Mempool Size<span class="info-icon" data-metric="mempool" aria-label="Learn more">i</span></span>
                        <span class="data-value">20,420 txs</span>
                    </div>
                </div>
            </div>

            <!-- Bitcoin News Feed -->
            <div class="section-header mt-40">
                <h2 class="section-title">Bitcoin News</h2>
                <p class="section-subtitle">Latest headlines from around the web</p>
            </div>
            <div class="card mb-24">
                <div class="news-grid" id="news-feed">
                    <div class="news-loading">Loading latest news...</div>
                </div>
            </div>

            <!-- Daily Discussion Section -->
            <div class="section-header mt-40">
                <h2 class="section-title">Daily Discussion</h2>
                <p class="section-subtitle">Share your thoughts - conversation resets daily</p>
            </div>

            <div class="comments-section" style="margin-top: 0;">
                <div class="comments-card">
                    <div id="comments-container">
                        <div class="comment-form" id="comment-form">
                            <input type="text" class="comment-name-input" id="comment-name"
                                   placeholder="Your name" maxlength="50">
                            <textarea class="comment-textarea" id="comment-text"
                                      placeholder="Share your thoughts on today's market..." maxlength="500"></textarea>
                            <button class="comment-submit" id="comment-submit">Post Comment</button>
                        </div>
                        <div class="comments-list" id="comments-list">
                            <div class="comments-loading">Loading comments...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Roadmap Footer -->
        <div class="roadmap-footer">
            <h3 class="roadmap-title">Coming Soon</h3>
            <ul class="roadmap-list">
                <li>Price Alerts</li>
                <li>Portfolio Tracker</li>
                <li>Weekly Email Digest</li>
                <li>Mobile App</li>
            </ul>
        </div>
    </main>

    <footer>
        <div class="container">
            <p class="footer-text">The Bitcoin Pulse</p>
            <p class="footer-links">Data: CoinGecko  Alternative.me  Blockchain.com  Mempool.space  Blockchair</p>
            <p class="footer-links" style="margin-top: 8px;">
                <span id="last-update">Last updated: 21:48 UTC</span> 
                <span id="update-status">Auto-refresh: ON</span>
            </p>
        </div>
    </footer>

    <!-- Glossary Modal -->
    <div class="glossary-overlay" id="glossary-overlay">
        <div class="glossary-modal">
            <div class="glossary-header">
                <h2 class="glossary-title">Bitcoin Glossary</h2>
                <button class="glossary-close" id="glossary-close" aria-label="Close glossary">&times;</button>
            </div>
            <div class="glossary-search">
                <input type="text" id="glossary-search-input" placeholder="Search metrics..." autocomplete="off">
            </div>
            <div class="glossary-filters">
                <button class="filter-btn active" data-category="all">All</button>
                <button class="filter-btn" data-category="price">Price & Market</button>
                <button class="filter-btn" data-category="sentiment">Sentiment</button>
                <button class="filter-btn" data-category="network">Network</button>
                <button class="filter-btn" data-category="supply">Supply</button>
                <button class="filter-btn" data-category="trading">Trading</button>
            </div>
            <div class="glossary-content" id="glossary-content">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // ===== Glossary Data =====
        const glossaryData = {"metrics": {"fear_greed": {"key": "fear_greed", "displayName": "Fear & Greed Index", "shortDescription": "Market sentiment indicator (0-100)", "fullDescription": "Measures market sentiment by analyzing volatility, momentum, social media, and Bitcoin dominance. Values range from 0 (Extreme Fear) to 100 (Extreme Greed).", "whyItMatters": "Extreme fear often signals buying opportunities; extreme greed may indicate market tops. Contrarian investors use this to time entries and exits.", "sources": ["https://alternative.me/crypto/fear-and-greed-index/"], "category": "sentiment"}, "hash_rate": {"key": "hash_rate", "displayName": "Hash Rate", "shortDescription": "Total network computing power (EH/s)", "fullDescription": "The total computational power being used to mine and process Bitcoin transactions, measured in exahashes per second (EH/s). Higher hash rate means more security.", "whyItMatters": "A rising hash rate indicates strong miner confidence and network security. Declining hash rate may signal miner capitulation or infrastructure issues.", "sources": ["https://blockchain.info/charts/hash-rate"], "category": "network"}, "difficulty": {"key": "difficulty", "displayName": "Mining Difficulty", "shortDescription": "How hard it is to mine a block", "fullDescription": "A measure of how difficult it is to find a valid block hash. Adjusts every 2,016 blocks (~2 weeks) to maintain ~10 minute block times.", "whyItMatters": "Difficulty follows hash rate. Increasing difficulty means more competition among miners. Decreasing difficulty can indicate miners leaving the network.", "sources": ["https://blockchain.info/charts/difficulty"], "category": "network"}, "block_height": {"key": "block_height", "displayName": "Block Height", "shortDescription": "Current blockchain length", "fullDescription": "The number of blocks that have been mined since Bitcoin's genesis block (block 0) on January 3, 2009.", "whyItMatters": "Block height is used to track halving events (every 210,000 blocks) and measure the network's progress over time.", "sources": ["https://mempool.space/"], "category": "network"}, "block_reward": {"key": "block_reward", "displayName": "Block Reward", "shortDescription": "BTC rewarded per block mined", "fullDescription": "The amount of new Bitcoin created and awarded to miners for each block they successfully mine. Started at 50 BTC and halves every 210,000 blocks.", "whyItMatters": "Block rewards affect miner economics and Bitcoin's inflation rate. After each halving, Bitcoin becomes scarcer as new supply decreases.", "sources": ["https://mempool.space/"], "category": "supply"}, "halving": {"key": "halving", "displayName": "Bitcoin Halving", "shortDescription": "50% reduction in block rewards", "fullDescription": "An event that occurs every 210,000 blocks (~4 years) where the block reward is cut in half. Reduces Bitcoin's inflation rate and new supply entering the market.", "whyItMatters": "Halvings historically precede major bull runs due to supply shock. They represent Bitcoin's programmatic monetary policy.", "sources": ["https://www.bitcoinblockhalf.com/"], "category": "supply"}, "circulating_supply": {"key": "circulating_supply", "displayName": "Circulating Supply", "shortDescription": "BTC currently in existence", "fullDescription": "The total number of Bitcoin that have been mined and are currently in circulation. Maximum supply is capped at 21 million BTC.", "whyItMatters": "Shows how much of Bitcoin's total supply has been released. Currently over 94% of all Bitcoin that will ever exist has been mined.", "sources": ["https://www.coingecko.com/"], "category": "supply"}, "market_cap": {"key": "market_cap", "displayName": "Market Cap", "shortDescription": "Total value of all BTC", "fullDescription": "The total market value of Bitcoin calculated by multiplying the current price by the circulating supply.", "whyItMatters": "Market cap indicates Bitcoin's relative size compared to other assets. It's used to compare cryptocurrencies and track overall market growth.", "sources": ["https://www.coingecko.com/"], "category": "price"}, "volume_24h": {"key": "volume_24h", "displayName": "24h Trading Volume", "shortDescription": "Value traded in last 24 hours", "fullDescription": "The total value of Bitcoin traded across all exchanges in the past 24 hours, measured in USD.", "whyItMatters": "High volume confirms price trends; low volume during price moves may indicate weak conviction. Volume spikes often precede major price movements.", "sources": ["https://www.coingecko.com/"], "category": "trading"}, "ath": {"key": "ath", "displayName": "All-Time High (ATH)", "shortDescription": "Highest price ever reached", "fullDescription": "The highest price Bitcoin has ever reached in its trading history. Used as a key psychological and technical level.", "whyItMatters": "Breaking ATH often triggers FOMO and media attention. Distance from ATH indicates potential upside or how far price has fallen.", "sources": ["https://www.coingecko.com/"], "category": "price"}, "sma_7": {"key": "sma_7", "displayName": "7-Day Moving Average", "shortDescription": "Average price over 7 days", "fullDescription": "The simple moving average of Bitcoin's price over the last 7 days. Smooths out short-term volatility to show recent trend.", "whyItMatters": "Price above the 7D MA suggests short-term bullish momentum. Crossovers can signal trend changes.", "sources": [], "category": "trading"}, "sma_20": {"key": "sma_20", "displayName": "20-Day Moving Average", "shortDescription": "Average price over 20 days", "fullDescription": "The simple moving average of Bitcoin's price over the last 20 days. Commonly used to identify medium-term trends.", "whyItMatters": "The 20D MA is a key support/resistance level. Traders watch for price crosses above or below this average.", "sources": [], "category": "trading"}, "sma_50": {"key": "sma_50", "displayName": "50-Day Moving Average", "shortDescription": "Average price over 50 days", "fullDescription": "The simple moving average of Bitcoin's price over the last 50 days. Important indicator for medium-term trend direction.", "whyItMatters": "When price crosses above the 50D MA, it's often seen as bullish. The 50D MA often acts as dynamic support in uptrends.", "sources": [], "category": "trading"}, "sma_200": {"key": "sma_200", "displayName": "200-Day Moving Average", "shortDescription": "Average price over 200 days", "fullDescription": "The simple moving average of Bitcoin's price over the last 200 days. The most widely followed long-term trend indicator.", "whyItMatters": "Price above the 200D MA indicates a bull market; below suggests a bear market. Golden/death crosses with the 50D MA are major signals.", "sources": [], "category": "trading"}, "active_addresses": {"key": "active_addresses", "displayName": "Active Addresses", "shortDescription": "Unique addresses used today", "fullDescription": "The number of unique Bitcoin addresses that sent or received Bitcoin in the past 24 hours.", "whyItMatters": "Rising active addresses indicate growing network usage and adoption. Declining activity may signal reduced interest or consolidation.", "sources": ["https://blockchain.info/charts/n-unique-addresses"], "category": "network"}, "tx_count": {"key": "tx_count", "displayName": "Daily Transactions", "shortDescription": "Transactions confirmed today", "fullDescription": "The number of Bitcoin transactions confirmed on the blockchain in the past 24 hours.", "whyItMatters": "Transaction count reflects network demand and usage. High counts may lead to congestion and higher fees.", "sources": ["https://blockchain.info/charts/n-transactions"], "category": "network"}, "mempool": {"key": "mempool", "displayName": "Mempool Size", "shortDescription": "Pending transactions", "fullDescription": "The number of unconfirmed transactions waiting to be included in a block. Acts as a queue for Bitcoin transactions.", "whyItMatters": "Large mempool means network congestion and higher fees. Small mempool indicates fast, cheap transactions.", "sources": ["https://mempool.space/"], "category": "network"}, "fee_rate": {"key": "fee_rate", "displayName": "Fee Rate", "shortDescription": "Cost per transaction (sat/vB)", "fullDescription": "The fee required to get a transaction confirmed, measured in satoshis per virtual byte. Higher fees = faster confirmation.", "whyItMatters": "Fee rates indicate network demand. High fees during bull runs can make small transactions impractical. Low fees suggest reduced activity.", "sources": ["https://mempool.space/"], "category": "network"}, "btc_dominance": {"key": "btc_dominance", "displayName": "BTC Dominance", "shortDescription": "Bitcoin's share of crypto market", "fullDescription": "Bitcoin's market cap as a percentage of the total cryptocurrency market cap. Measures Bitcoin's relative importance.", "whyItMatters": "Rising dominance suggests investors prefer Bitcoin over altcoins. Falling dominance may indicate 'alt season' where altcoins outperform.", "sources": ["https://www.coingecko.com/"], "category": "trading"}, "funding_rate": {"key": "funding_rate", "displayName": "Funding Rate", "shortDescription": "Cost to hold leveraged positions", "fullDescription": "The periodic payment between long and short traders in perpetual futures markets. Keeps futures price aligned with spot price.", "whyItMatters": "Positive funding = longs pay shorts (bullish sentiment). Negative funding = shorts pay longs (bearish). Extreme rates often precede reversals.", "sources": ["https://www.coinglass.com/"], "category": "trading"}, "open_interest": {"key": "open_interest", "displayName": "Open Interest", "shortDescription": "Outstanding derivatives contracts", "fullDescription": "The total value of outstanding Bitcoin futures and perpetual swap contracts across all exchanges.", "whyItMatters": "Rising OI with rising price = strong trend. Rising OI with falling price = potential short squeeze setup. High OI increases liquidation risk.", "sources": ["https://www.coinglass.com/"], "category": "trading"}, "liquidations": {"key": "liquidations", "displayName": "Liquidations", "shortDescription": "Forced position closures", "fullDescription": "The dollar value of leveraged positions that were forcibly closed due to insufficient margin in the past 24 hours.", "whyItMatters": "Large liquidations cause cascading price moves. Long liquidations accelerate drops; short liquidations accelerate pumps.", "sources": ["https://www.coinglass.com/"], "category": "trading"}, "whale_transactions": {"key": "whale_transactions", "displayName": "Whale Transactions", "shortDescription": "Large BTC movements", "fullDescription": "Transactions moving large amounts of Bitcoin (typically 100+ BTC). Often tracked to identify potential market-moving activity.", "whyItMatters": "Whale movements to exchanges may signal selling pressure. Movements to cold storage suggest accumulation and long-term holding.", "sources": ["https://blockchair.com/"], "category": "network"}, "sats_per_dollar": {"key": "sats_per_dollar", "displayName": "Sats per Dollar", "shortDescription": "Satoshis you can buy for $1", "fullDescription": "The number of satoshis (the smallest Bitcoin unit, 0.00000001 BTC) that can be purchased for one US dollar.", "whyItMatters": "Makes Bitcoin more relatable for small investors. Useful for DCA strategies and understanding fractional Bitcoin ownership.", "sources": [], "category": "price"}, "utxo_count": {"key": "utxo_count", "displayName": "UTXO Count", "shortDescription": "Unspent transaction outputs", "fullDescription": "The total number of unspent transaction outputs in the Bitcoin network. Each UTXO represents spendable Bitcoin.", "whyItMatters": "Growing UTXO set indicates more distributed ownership. UTXO age distribution shows holder behavior patterns.", "sources": ["https://blockchair.com/"], "category": "network"}, "nodes": {"key": "nodes", "displayName": "Network Nodes", "shortDescription": "Computers running Bitcoin", "fullDescription": "The number of reachable full nodes running the Bitcoin software and validating transactions.", "whyItMatters": "More nodes = more decentralization and resilience. Node count reflects the network's health and censorship resistance.", "sources": ["https://blockchair.com/"], "category": "network"}}, "categories": {"price": {"name": "Price & Market", "icon": "chart_line", "description": "Price movements, market cap, and valuation metrics"}, "sentiment": {"name": "Sentiment", "icon": "lightbulb", "description": "Market mood and investor psychology indicators"}, "network": {"name": "Network Health", "icon": "link", "description": "On-chain metrics and blockchain activity"}, "supply": {"name": "Supply", "icon": "coins", "description": "Bitcoin issuance and scarcity metrics"}, "trading": {"name": "Trading", "icon": "chart_bar", "description": "Volume, derivatives, and technical indicators"}}};

        // ===== Configuration =====
        const PRICE_UPDATE_INTERVAL = 10000;  // 10 seconds for price
        const CHART_UPDATE_INTERVAL = 60000;  // 60 seconds for chart data
        const FULL_UPDATE_INTERVAL = 120000;  // 2 minutes for all other data

        let priceChart = null;
        let currentTimeframe = 7;
        let chartData = [];
        let chartDataUSD = [];  // Store original USD data for conversion
        let lastPrice = 72938;
        let lastPriceUSD = 72938;  // Store USD price for conversion
        let isChartLoading = false;

        // MA visibility state
        let showMA7 = true;
        let showMA20 = true;
        let showMA50 = false;

        // ===== Formatters =====
        function formatPrice(n, skipConversion = false) {
            const symbol = (typeof currentCurrency !== 'undefined') ? currentCurrency.symbol : '$';
            const rate = (typeof currentCurrency !== 'undefined' && !skipConversion) ? currentCurrency.rate : 1;
            const converted = n * rate;
            return symbol + converted.toLocaleString('en-US', {maximumFractionDigits: 0});
        }

        function formatPriceDecimal(n, skipConversion = false) {
            const symbol = (typeof currentCurrency !== 'undefined') ? currentCurrency.symbol : '$';
            const rate = (typeof currentCurrency !== 'undefined' && !skipConversion) ? currentCurrency.rate : 1;
            const converted = n * rate;
            return symbol + converted.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }

        function formatPercent(n) {
            const sign = n >= 0 ? '+' : '';
            return sign + n.toFixed(2) + '%';
        }

        function formatLarge(n, skipConversion = false) {
            const symbol = (typeof currentCurrency !== 'undefined') ? currentCurrency.symbol : '$';
            const rate = (typeof currentCurrency !== 'undefined' && !skipConversion) ? currentCurrency.rate : 1;
            const converted = n * rate;
            if (converted >= 1e12) return symbol + (converted/1e12).toFixed(2) + 'T';
            if (converted >= 1e9) return symbol + (converted/1e9).toFixed(2) + 'B';
            if (converted >= 1e6) return symbol + (converted/1e6).toFixed(2) + 'M';
            return symbol + converted.toLocaleString();
        }

        // ===== Chart Functions =====

        // Fast Binance API for chart data
        async function fetchBinanceChart(days) {
            // Map days to Binance intervals
            let interval, limit;
            if (days === 'max') {
                // All-time: weekly candles
                interval = '1w';
                limit = 1000;
            } else if (days <= 0.5) {
                // 6 hours or less: 1-minute candles
                interval = '1m';
                limit = Math.ceil(days * 24 * 60);
            } else if (days <= 1) {
                interval = '5m';
                limit = 288;  // 5min * 288 = 24h
            } else if (days <= 7) {
                interval = '1h';
                limit = Math.ceil(days * 24);
            } else if (days <= 30) {
                interval = '4h';
                limit = Math.ceil(days * 6);
            } else if (days <= 365) {
                interval = '1d';
                limit = Math.ceil(days);
            } else {
                // More than 1 year: weekly candles
                interval = '1w';
                limit = Math.ceil(days / 7);
            }

            const url = `https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${interval}&limit=${limit}`;
            const response = await fetch(url);

            if (!response.ok) throw new Error('Binance API error');

            const data = await response.json();

            // Transform Binance data to our format [timestamp, closePrice]
            // Binance kline: [openTime, open, high, low, close, volume, closeTime, ...]
            return data.map(candle => [
                candle[0],  // timestamp
                parseFloat(candle[4])  // close price
            ]);
        }

        async function fetchChartData(days, retryCount = 0) {
            // Try Binance first (faster, no rate limits)
            try {
                const binanceData = await fetchBinanceChart(days);
                if (binanceData && binanceData.length > 0) {
                    console.log('Chart data from Binance:', binanceData.length, 'points');
                    return binanceData;
                }
            } catch (e) {
                console.log('Binance failed, trying CoinGecko:', e.message);
            }

            // Fallback to CoinGecko
            const maxRetries = 3;
            const retryDelay = 2000;

            const url = `https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=${days}`;

            console.log('Fetching chart data from CoinGecko:', url);

            try {
                const response = await fetch(url);

                if (response.status === 429) {
                    console.warn('Rate limited');
                    if (retryCount < maxRetries) {
                        console.log(`Retrying in ${retryDelay/1000}s... (attempt ${retryCount + 1}/${maxRetries})`);
                        await new Promise(resolve => setTimeout(resolve, retryDelay * (retryCount + 1)));
                        return fetchChartData(days, retryCount + 1);
                    }
                    console.warn('Max retries reached, using cached data');
                    return chartData.length > 0 ? chartData : [];
                }

                if (!response.ok) {
                    console.error('API error:', response.status);
                    if (retryCount < maxRetries) {
                        await new Promise(resolve => setTimeout(resolve, retryDelay));
                        return fetchChartData(days, retryCount + 1);
                    }
                    return chartData.length > 0 ? chartData : [];
                }

                const data = await response.json();

                if (data.prices && data.prices.length > 0) {
                    console.log('Got ' + data.prices.length + ' data points');
                    return data.prices;
                }

                return chartData.length > 0 ? chartData : [];
            } catch (error) {
                console.error('Chart data fetch failed:', error);
                if (retryCount < maxRetries) {
                    await new Promise(resolve => setTimeout(resolve, retryDelay));
                    return fetchChartData(days, retryCount + 1);
                }
                return chartData.length > 0 ? chartData : [];
            }
        }

        function initChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');

            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, 'rgba(246, 133, 27, 0.3)');
            gradient.addColorStop(1, 'rgba(246, 133, 27, 0)');

            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'BTC Price',
                            data: [],
                            borderColor: '#f6851b',
                            backgroundColor: gradient,
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 6,
                            pointHoverBackgroundColor: '#f6851b',
                            pointHoverBorderColor: '#fff',
                            pointHoverBorderWidth: 2,
                            order: 0
                        },
                        {
                            label: '7D MA',
                            data: [],
                            borderColor: '#58a6ff',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0,
                            hidden: !showMA7,
                            order: 1
                        },
                        {
                            label: '20D MA',
                            data: [],
                            borderColor: '#3fb950',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0,
                            hidden: !showMA20,
                            order: 2
                        },
                        {
                            label: '50D MA',
                            data: [],
                            borderColor: '#f85149',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0,
                            hidden: !showMA50,
                            order: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#161b22',
                            titleColor: '#f0f6fc',
                            bodyColor: '#f0f6fc',
                            borderColor: '#30363d',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true,
                            callbacks: {
                                title: (items) => {
                                    const date = new Date(items[0].label);
                                    return date.toLocaleString();
                                },
                                label: (item) => item.dataset.label + ': ' + formatPriceDecimal(item.raw, true)
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: { color: 'rgba(48, 54, 61, 0.5)', drawBorder: false },
                            ticks: {
                                color: '#6e7681',
                                maxTicksLimit: 6,
                                callback: function(val, index) {
                                    const date = new Date(this.getLabelForValue(val));
                                    if (currentTimeframe <= 1) {
                                        return date.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
                                    }
                                    return date.toLocaleDateString([], {month: 'short', day: 'numeric'});
                                }
                            }
                        },
                        y: {
                            display: true,
                            position: 'right',
                            grid: { color: 'rgba(48, 54, 61, 0.5)', drawBorder: false },
                            ticks: {
                                color: '#6e7681',
                                callback: (val) => formatPrice(val, true)
                            }
                        }
                    }
                }
            });
        }

        // Calculate moving average from price data
        function calculateMA(prices, period) {
            if (prices.length < period) return [];

            const ma = [];
            for (let i = 0; i < prices.length; i++) {
                if (i < period - 1) {
                    ma.push(null);
                } else {
                    const sum = prices.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);
                    ma.push(sum / period);
                }
            }
            return ma;
        }

        async function updateChart(days) {
            if (isChartLoading) return;
            isChartLoading = true;

            // Show loading state
            const chartWrapper = document.querySelector('.chart-wrapper');
            if (chartWrapper) chartWrapper.style.opacity = '0.5';

            currentTimeframe = days;
            const newData = await fetchChartData(days);

            // Only update if we got data
            if (newData && newData.length > 0) {
                chartDataUSD = newData;  // Store original USD data
                chartData = newData;

                const labels = chartData.map(p => p[0]);
                // Convert prices to current currency
                const rate = (typeof currentCurrency !== 'undefined') ? currentCurrency.rate : 1;
                const prices = chartData.map(p => p[1] * rate);

                // Calculate moving averages
                const ma7 = calculateMA(prices, 7);
                const ma20 = calculateMA(prices, 20);
                const ma50 = calculateMA(prices, 50);

                priceChart.data.labels = labels;
                priceChart.data.datasets[0].data = prices;
                priceChart.data.datasets[1].data = ma7;
                priceChart.data.datasets[2].data = ma20;
                priceChart.data.datasets[3].data = ma50;

                // Update MA visibility
                priceChart.data.datasets[1].hidden = !showMA7;
                priceChart.data.datasets[2].hidden = !showMA20;
                priceChart.data.datasets[3].hidden = !showMA50;

                priceChart.update('none');

                // Update chart stats - calculate from USD values, let formatPriceDecimal handle conversion
                const usdPrices = chartDataUSD.map(p => p[1]);
                const highUSD = Math.max(...usdPrices);
                const lowUSD = Math.min(...usdPrices);
                const avgUSD = usdPrices.reduce((a, b) => a + b, 0) / usdPrices.length;
                const change = ((usdPrices[usdPrices.length - 1] - usdPrices[0]) / usdPrices[0]) * 100;

                document.getElementById('chart-high').textContent = formatPriceDecimal(highUSD);
                document.getElementById('chart-low').textContent = formatPriceDecimal(lowUSD);
                document.getElementById('chart-avg').textContent = formatPriceDecimal(avgUSD);

                const changeEl = document.getElementById('chart-change');
                changeEl.textContent = formatPercent(change);
                changeEl.style.color = change >= 0 ? '#3fb950' : '#f85149';
            } else {
                console.warn('No chart data available for ' + days + ' days');
            }

            // Remove loading state
            if (chartWrapper) chartWrapper.style.opacity = '1';
            isChartLoading = false;
        }

        function addPriceToChart(newPriceUSD) {
            if (!priceChart || chartDataUSD.length === 0) return;

            const now = Date.now();
            chartDataUSD.push([now, newPriceUSD]);
            chartData.push([now, newPriceUSD]);

            // Remove old data points if too many
            const maxPoints = currentTimeframe <= 1 ? 96 : (currentTimeframe * 24);
            if (chartDataUSD.length > maxPoints) {
                chartDataUSD.shift();
                chartData.shift();
            }

            // Convert to current currency for display
            const rate = (typeof currentCurrency !== 'undefined') ? currentCurrency.rate : 1;
            priceChart.data.labels = chartDataUSD.map(p => p[0]);
            priceChart.data.datasets[0].data = chartDataUSD.map(p => p[1] * rate);
            priceChart.update('none');
        }

        // ===== Data Update Functions =====
        async function updatePrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true&include_market_cap=true&include_24hr_vol=true');
                const data = await response.json();

                if (data.bitcoin) {
                    const btc = data.bitcoin;
                    const newPriceUSD = btc.usd;
                    lastPriceUSD = newPriceUSD;  // Store USD price

                    // Get current currency rate
                    const rate = (typeof currentCurrency !== 'undefined') ? currentCurrency.rate : 1;
                    const symbol = (typeof currentCurrency !== 'undefined') ? currentCurrency.symbol : '$';
                    const code = (typeof currentCurrency !== 'undefined') ? currentCurrency.code : 'USD';
                    const newPrice = newPriceUSD * rate;

                    // Update hero price with flash effect
                    const heroPrice = document.querySelector('.hero-price');
                    if (heroPrice) {
                        const oldPrice = lastPrice;
                        heroPrice.innerHTML = symbol + newPrice.toLocaleString('en-US', {maximumFractionDigits: 0}) +
                            '<span class="price-currency">' + code + '</span>';
                        if (newPriceUSD !== (oldPrice / rate)) {
                            heroPrice.style.transition = 'color 0.3s';
                            heroPrice.style.color = newPriceUSD > (oldPrice / rate) ? '#3fb950' : '#f85149';
                            setTimeout(() => { heroPrice.style.color = '#f0f6fc'; }, 500);
                        }
                        lastPrice = newPrice;
                    }

                    // Update 24h change
                    const heroChange = document.querySelector('.hero-change');
                    if (heroChange) {
                        const change = btc.usd_24h_change || 0;
                        const arrow = change >= 0 ? '' : '';
                        heroChange.innerHTML = arrow + ' ' + formatPercent(change) + ' (24h)';
                        heroChange.style.background = change >= 0 ? 'rgba(63, 185, 80, 0.1)' : 'rgba(248, 81, 73, 0.1)';
                        heroChange.style.color = change >= 0 ? '#3fb950' : '#f85149';
                    }

                    // Update stats row - update USD values and convert
                    const marketCapEl = document.getElementById('stat-market-cap');
                    if (marketCapEl) {
                        marketCapEl.dataset.usd = btc.usd_market_cap;
                        marketCapEl.textContent = formatLarge(btc.usd_market_cap);
                    }
                    const volumeEl = document.getElementById('stat-volume');
                    if (volumeEl) {
                        volumeEl.dataset.usd = btc.usd_24h_vol;
                        volumeEl.textContent = formatLarge(btc.usd_24h_vol);
                    }

                    // Update current price in cards - use USD value, let formatPriceDecimal convert
                    const priceValues = document.querySelectorAll('.data-value.accent');
                    if (priceValues[0]) priceValues[0].textContent = formatPriceDecimal(newPriceUSD);

                    // Add to chart if timeframe is 24h - store USD value
                    if (currentTimeframe <= 1) {
                        addPriceToChart(newPriceUSD);
                    }

                    // Update timestamp
                    const now = new Date();
                    document.getElementById('last-update').textContent =
                        'Last updated: ' + now.toUTCString().slice(17, 25) + ' UTC';
                }
            } catch (error) {
                console.log('Price update failed:', error);
            }
        }

        async function updateFearGreed() {
            try {
                const response = await fetch('https://api.alternative.me/fng/');
                const data = await response.json();

                if (data.data && data.data[0]) {
                    const fg = data.data[0];
                    const value = parseInt(fg.value);
                    const classification = fg.value_classification;

                    const fgValue = document.querySelector('.fg-value');
                    const fgLabel = document.querySelector('.fg-label');
                    const fgIndicator = document.querySelector('.fg-indicator');

                    if (fgValue) fgValue.textContent = value;
                    if (fgLabel) fgLabel.textContent = classification;
                    if (fgIndicator) fgIndicator.style.left = value + '%';

                    // Update colors based on value
                    let color;
                    if (value >= 75) color = '#22c55e';
                    else if (value >= 55) color = '#84cc16';
                    else if (value >= 45) color = '#eab308';
                    else if (value >= 25) color = '#f97316';
                    else color = '#ef4444';

                    if (fgValue) fgValue.style.color = color;
                    if (fgLabel) fgLabel.style.color = color;
                }
            } catch (error) {
                console.log('Fear & Greed update failed:', error);
            }
        }

        async function updateExtendedData() {
            try {
                // Fetch Bitcoin data with more details
                const response = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin?localization=false&tickers=false&community_data=false&developer_data=false');
                const data = await response.json();

                if (data.market_data) {
                    const md = data.market_data;

                    // Update 7d and 30d changes
                    const statItems = document.querySelectorAll('.stat-item');
                    if (statItems[2]) {
                        const change7d = md.price_change_percentage_7d || 0;
                        const el = statItems[2].querySelector('.stat-value');
                        el.textContent = formatPercent(change7d);
                        el.className = 'stat-value ' + (change7d >= 0 ? 'green' : 'red');
                    }
                    if (statItems[3]) {
                        const change30d = md.price_change_percentage_30d || 0;
                        const el = statItems[3].querySelector('.stat-value');
                        el.textContent = formatPercent(change30d);
                        el.className = 'stat-value ' + (change30d >= 0 ? 'green' : 'red');
                    }
                }
            } catch (error) {
                console.log('Extended data update failed:', error);
            }

            // Also update Fear & Greed
            await updateFearGreed();
        }

        // ===== Currency Conversion =====
        let currentCurrency = { code: 'USD', symbol: '$', rate: 1 };
        const basePriceUSD = 72938;

        function initCurrencySelector() {
            const selector = document.getElementById('currency-selector');
            const btn = document.getElementById('currency-btn');
            const dropdown = document.getElementById('currency-dropdown');
            const display = document.getElementById('currency-display');
            const options = dropdown.querySelectorAll('.currency-option');

            // Load saved preference
            const saved = localStorage.getItem('btcPulseCurrency');
            if (saved) {
                try {
                    const savedCurrency = JSON.parse(saved);
                    currentCurrency = savedCurrency;
                    display.textContent = savedCurrency.code;
                    options.forEach(opt => {
                        opt.classList.toggle('active', opt.dataset.currency === savedCurrency.code);
                    });
                    convertAllPrices();
                } catch (e) {}
            }

            // Toggle dropdown
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                selector.classList.toggle('open');
            });

            // Select currency
            options.forEach(opt => {
                opt.addEventListener('click', () => {
                    const code = opt.dataset.currency;
                    const symbol = opt.dataset.symbol;
                    const rate = parseFloat(opt.dataset.rate);

                    currentCurrency = { code, symbol, rate };
                    display.textContent = code;
                    localStorage.setItem('btcPulseCurrency', JSON.stringify(currentCurrency));

                    options.forEach(o => o.classList.remove('active'));
                    opt.classList.add('active');
                    selector.classList.remove('open');

                    convertAllPrices();
                });
            });

            // Close on outside click
            document.addEventListener('click', () => {
                selector.classList.remove('open');
            });
        }

        function convertPrice(usdPrice) {
            return usdPrice * currentCurrency.rate;
        }

        function formatConvertedPrice(usdPrice, decimals = 0) {
            const converted = convertPrice(usdPrice);
            if (currentCurrency.code === 'JPY' || currentCurrency.code === 'INR') {
                return currentCurrency.symbol + Math.round(converted).toLocaleString();
            }
            return currentCurrency.symbol + converted.toLocaleString(undefined, {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            });
        }

        function convertAllPrices() {
            // Hero price - always convert from base USD
            const heroPrice = document.querySelector('.hero-price');
            if (heroPrice) {
                heroPrice.innerHTML = formatConvertedPrice(basePriceUSD) +
                    '<span class="price-currency">' + currentCurrency.code + '</span>';
            }

            // Market Cap and 24h Volume - use formatLarge with conversion
            const marketCapEl = document.getElementById('stat-market-cap');
            if (marketCapEl && marketCapEl.dataset.usd) {
                marketCapEl.textContent = formatLarge(parseFloat(marketCapEl.dataset.usd));
            }

            const volumeEl = document.getElementById('stat-volume');
            if (volumeEl && volumeEl.dataset.usd) {
                volumeEl.textContent = formatLarge(parseFloat(volumeEl.dataset.usd));
            }

            // 30-Day Price Range card
            const priceCurrentEl = document.getElementById('price-current');
            if (priceCurrentEl && priceCurrentEl.dataset.usd) {
                priceCurrentEl.textContent = formatConvertedPrice(parseFloat(priceCurrentEl.dataset.usd), 2);
            }

            const priceHigh30dEl = document.getElementById('price-high-30d');
            if (priceHigh30dEl && priceHigh30dEl.dataset.usd) {
                priceHigh30dEl.textContent = formatConvertedPrice(parseFloat(priceHigh30dEl.dataset.usd), 2);
            }

            const priceLow30dEl = document.getElementById('price-low-30d');
            if (priceLow30dEl && priceLow30dEl.dataset.usd) {
                priceLow30dEl.textContent = formatConvertedPrice(parseFloat(priceLow30dEl.dataset.usd), 2);
            }

            const priceAthEl = document.getElementById('price-ath');
            if (priceAthEl && priceAthEl.dataset.usd) {
                priceAthEl.textContent = formatConvertedPrice(parseFloat(priceAthEl.dataset.usd));
            }

            // Moving Averages card
            const ma7dEl = document.getElementById('ma-7d');
            if (ma7dEl && ma7dEl.dataset.usd && parseFloat(ma7dEl.dataset.usd) > 0) {
                const pct = parseFloat(ma7dEl.dataset.pct);
                ma7dEl.innerHTML = formatConvertedPrice(parseFloat(ma7dEl.dataset.usd)) + ' <small>(' + (pct >= 0 ? '+' : '') + pct.toFixed(1) + '%)</small>';
            }

            const ma20dEl = document.getElementById('ma-20d');
            if (ma20dEl && ma20dEl.dataset.usd && parseFloat(ma20dEl.dataset.usd) > 0) {
                const pct = parseFloat(ma20dEl.dataset.pct);
                ma20dEl.innerHTML = formatConvertedPrice(parseFloat(ma20dEl.dataset.usd)) + ' <small>(' + (pct >= 0 ? '+' : '') + pct.toFixed(1) + '%)</small>';
            }

            const ma50dEl = document.getElementById('ma-50d');
            if (ma50dEl && ma50dEl.dataset.usd && parseFloat(ma50dEl.dataset.usd) > 0) {
                const pct = parseFloat(ma50dEl.dataset.pct);
                ma50dEl.innerHTML = formatConvertedPrice(parseFloat(ma50dEl.dataset.usd)) + ' <small>(' + (pct >= 0 ? '+' : '') + pct.toFixed(1) + '%)</small>';
            }

            // Market Dominance card
            const totalCryptoMcapEl = document.getElementById('total-crypto-mcap');
            if (totalCryptoMcapEl && totalCryptoMcapEl.dataset.usd) {
                totalCryptoMcapEl.textContent = formatLarge(parseFloat(totalCryptoMcapEl.dataset.usd));
            }

            const btcMarketCapEl = document.getElementById('btc-market-cap');
            if (btcMarketCapEl && btcMarketCapEl.dataset.usd) {
                btcMarketCapEl.textContent = formatLarge(parseFloat(btcMarketCapEl.dataset.usd));
            }

            // Trading Volume card
            const tradingVolume24hEl = document.getElementById('trading-volume-24h');
            if (tradingVolume24hEl && tradingVolume24hEl.dataset.usd) {
                tradingVolume24hEl.textContent = formatLarge(parseFloat(tradingVolume24hEl.dataset.usd));
            }

            const txVolume24hEl = document.getElementById('tx-volume-24h');
            if (txVolume24hEl && txVolume24hEl.dataset.usd) {
                txVolume24hEl.textContent = formatLarge(parseFloat(txVolume24hEl.dataset.usd));
            }

            // Comparison table prices - store USD in data attribute on first run
            document.querySelectorAll('.comparison-table td').forEach(td => {
                // Store original USD value on first conversion
                if (!td.dataset.usd && td.textContent.match(/^[$A-Z]/)) {
                    const num = parseFloat(td.textContent.replace(/[^\d.]/g, ''));
                    if (!isNaN(num)) {
                        td.dataset.usd = num;
                    }
                }
                // Convert from stored USD value
                if (td.dataset.usd) {
                    td.textContent = formatConvertedPrice(parseFloat(td.dataset.usd));
                }
            });

            // Changes list prices - store original USD values
            document.querySelectorAll('.changes-list span').forEach(span => {
                const text = span.textContent;
                // Store original on first run
                if (!span.dataset.originalText && text.match(/[$]/)) {
                    span.dataset.originalText = text;
                    const match = text.match(/[$A-Z$]?([\d,]+)/);
                    if (match) {
                        span.dataset.usd = parseFloat(match[1].replace(/,/g, ''));
                    }
                }
                // Convert using stored values
                if (span.dataset.usd && span.dataset.originalText) {
                    const converted = formatConvertedPrice(parseFloat(span.dataset.usd));
                    span.textContent = span.dataset.originalText.replace(/[$A-Z$]?[\d,]+/, converted);
                }
            });

            // Historical table - store USD values
            document.querySelectorAll('.history-price-cell').forEach(cell => {
                if (!cell.dataset.usd && cell.textContent.match(/^[$A-Z]/)) {
                    const num = parseFloat(cell.textContent.replace(/[^\d.]/g, ''));
                    if (!isNaN(num)) {
                        cell.dataset.usd = num;
                    }
                }
                if (cell.dataset.usd) {
                    cell.textContent = formatConvertedPrice(parseFloat(cell.dataset.usd));
                }
            });

            // Update chart with converted prices
            if (priceChart && chartDataUSD && chartDataUSD.length > 0) {
                const convertedPrices = chartDataUSD.map(p => p[1] * currentCurrency.rate);
                priceChart.data.datasets[0].data = convertedPrices;

                // Recalculate MAs with converted prices
                const ma7 = calculateMA(convertedPrices, 7);
                const ma20 = calculateMA(convertedPrices, 20);
                const ma50 = calculateMA(convertedPrices, 50);
                priceChart.data.datasets[1].data = ma7;
                priceChart.data.datasets[2].data = ma20;
                priceChart.data.datasets[3].data = ma50;

                priceChart.update('none');

                // Update chart stats from USD values
                const usdPrices = chartDataUSD.map(p => p[1]);
                const highUSD = Math.max(...usdPrices);
                const lowUSD = Math.min(...usdPrices);
                const avgUSD = usdPrices.reduce((a, b) => a + b, 0) / usdPrices.length;

                const highEl = document.getElementById('chart-high');
                const lowEl = document.getElementById('chart-low');
                const avgEl = document.getElementById('chart-avg');

                if (highEl) highEl.textContent = formatConvertedPrice(highUSD);
                if (lowEl) lowEl.textContent = formatConvertedPrice(lowUSD);
                if (avgEl) avgEl.textContent = formatConvertedPrice(avgUSD);
            }

            // Track currency change
            if (typeof gtag === 'function') {
                gtag('event', 'currency_change', {
                    'event_category': 'settings',
                    'event_label': currentCurrency.code
                });
            }
        }

        // ===== Initialize =====
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize currency selector
            initCurrencySelector();

            // Initialize main price chart
            initChart();

            // Set up MA toggle buttons
            document.querySelectorAll('.ma-toggle-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();

                    const ma = this.dataset.ma;
                    this.classList.toggle('active');

                    if (ma === '7') {
                        showMA7 = !showMA7;
                        priceChart.data.datasets[1].hidden = !showMA7;
                        document.getElementById('legend-ma7').style.display = showMA7 ? 'flex' : 'none';
                    } else if (ma === '20') {
                        showMA20 = !showMA20;
                        priceChart.data.datasets[2].hidden = !showMA20;
                        document.getElementById('legend-ma20').style.display = showMA20 ? 'flex' : 'none';
                    } else if (ma === '50') {
                        showMA50 = !showMA50;
                        priceChart.data.datasets[3].hidden = !showMA50;
                        document.getElementById('legend-ma50').style.display = showMA50 ? 'flex' : 'none';
                    }

                    priceChart.update('none');
                });
            });

            // Set up timeframe button event listeners
            document.querySelectorAll('.timeframe-btn').forEach(btn => {
                btn.addEventListener('click', async function(e) {
                    e.preventDefault();

                    // Update button states
                    document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    // Show loading state
                    const chartWrapper = document.querySelector('.chart-wrapper');
                    chartWrapper.style.opacity = '0.5';

                    const daysRaw = this.dataset.days;
                    const days = daysRaw === 'max' ? 'max' : parseFloat(daysRaw);
                    console.log('Switching to ' + days + ' day view...');

                    try {
                        await updateChart(days);
                    } catch (err) {
                        console.error('Chart update failed:', err);
                    }

                    chartWrapper.style.opacity = '1';
                });
            });

            // Load initial chart data
            console.log('Loading initial 7-day chart...');
            await updateChart(7);

            // Start update intervals
            setInterval(updatePrice, PRICE_UPDATE_INTERVAL);
            setInterval(() => updateChart(currentTimeframe), CHART_UPDATE_INTERVAL);
            setInterval(updateExtendedData, FULL_UPDATE_INTERVAL);

            // Initial updates
            setTimeout(updatePrice, 2000);
            setTimeout(updateExtendedData, 5000);

            console.log('The Bitcoin Pulse: Live updates enabled');
            console.log('  - Price: every 10s');
            console.log('  - Chart: every 60s');
            console.log('  - Extended data: every 2min');
            console.log('  - Moving averages: 7D, 20D, 50D');

            // Initialize glossary
            initGlossary();

            // Initialize halving countdown
            initHalvingCountdown();

            // Initialize share button
            initShareButton();

            // Load news feed
            loadNewsFeed();

            // Initialize community features (Firebase-powered)
            initFirebase();
            initComments();
        });

        // ===== Halving Countdown =====
        const HALVING_DATA = {
            blocksUntilHalving: 114960,
            currentBlock: 935040,
            nextHalvingBlock: 1050000,
            lastHalvingBlock: 840000
        };

        function initHalvingCountdown() {
            updateHalvingCountdown();
            setInterval(updateHalvingCountdown, 60000); // Update every minute
        }

        function updateHalvingCountdown() {
            const blocksLeft = HALVING_DATA.blocksUntilHalving;
            const minutesLeft = blocksLeft * 10; // Avg 10 min per block

            const days = Math.floor(minutesLeft / 1440);
            const hours = Math.floor((minutesLeft % 1440) / 60);
            const mins = Math.floor(minutesLeft % 60);

            document.getElementById('countdown-days').textContent = days;
            document.getElementById('countdown-hours').textContent = hours;
            document.getElementById('countdown-mins').textContent = mins;
            document.getElementById('countdown-blocks').textContent = blocksLeft.toLocaleString();

            // Calculate progress (blocks since last halving / 210000)
            const blocksSinceLastHalving = 210000 - blocksLeft;
            const progressPct = (blocksSinceLastHalving / 210000) * 100;

            document.getElementById('halving-progress').style.width = progressPct.toFixed(1) + '%';
            document.getElementById('halving-progress-pct').textContent = progressPct.toFixed(1) + '%';
        }

        // ===== Share Button =====
        function initShareButton() {
            const shareBtn = document.getElementById('share-btn');
            const shareDropdown = document.getElementById('share-dropdown');

            shareBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                shareDropdown.classList.toggle('active');
            });

            document.addEventListener('click', () => {
                shareDropdown.classList.remove('active');
            });

            shareDropdown.querySelectorAll('.share-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const action = option.dataset.action;

                    if (action === 'copy') {
                        copyToClipboard();
                    } else if (action === 'twitter') {
                        shareToTwitter();
                    }

                    shareDropdown.classList.remove('active');
                });
            });
        }

        function copyToClipboard() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                showToast('Link copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('Link copied to clipboard!');
            });
        }

        function shareToTwitter() {
            const price = document.querySelector('.hero-price').textContent;
            const change = document.querySelector('.hero-change').textContent;
            const text = `Bitcoin is at ${price} (${change})\n\nLive data from The Bitcoin Pulse`;
            const url = 'https://thebitcoinpulse.com';
            const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
            window.open(twitterUrl, '_blank', 'width=550,height=420');
        }

        function showToast(message) {
            let toast = document.querySelector('.share-toast');
            if (!toast) {
                toast = document.createElement('div');
                toast.className = 'share-toast';
                document.body.appendChild(toast);
            }
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        // ===== News Feed =====
        const NEWS_DATA = [{"title": "Bitcoin open interest falls by $55B in 30 days: What\u2019s next for BTC price?", "url": "https://cointelegraph.com/news/bitcoin-open-interest-falls-by-dollar55b-in-30-days-what-s-next-for-btc-price?utm_source=rss_feed&utm_medium=rss_tag_bitcoin&utm_campaign=rss_partner_inbound", "source": "Cointelegraph", "published_at": "2026-02-04 19:45:00", "domain": "cointelegraph.com"}, {"title": "US won't 'bail out' Bitcoin, says Treasury Secretary Bessent", "url": "https://cointelegraph.com/news/us-treasury-bessent-wont-bail-out-bitcoin?utm_source=rss_feed&utm_medium=rss_tag_bitcoin&utm_campaign=rss_partner_inbound", "source": "Cointelegraph", "published_at": "2026-02-04 18:48:33", "domain": "cointelegraph.com"}, {"title": "Price predictions 2/4: BTC, ETH, BNB, XRP, SOL, DOGE, ADA, BCH, HYPE, XMR", "url": "https://cointelegraph.com/news/price-predictions-2-4-btc-eth-bnb-xrp-sol-doge-ada-bch-hype-xmr?utm_source=rss_feed&utm_medium=rss_tag_bitcoin&utm_campaign=rss_partner_inbound", "source": "Cointelegraph", "published_at": "2026-02-04 18:43:50", "domain": "cointelegraph.com"}, {"title": "Early Bitcoin Dev Calls on Adam Back to Resign After Epstein Files Revelations", "url": "https://decrypt.co/356929/bitcoin-dev-calls-adam-back-resign-epstein-files", "source": "Decrypt", "published_at": "2026-02-04 19:22:00", "domain": "decrypt.co"}];

        function loadNewsFeed() {
            const newsContainer = document.getElementById('news-feed');
            const news = NEWS_DATA;

            if (!news || news.length === 0) {
                newsContainer.innerHTML = `
                    <div class="news-item" style="cursor: default;">
                        <div class="news-content">
                            <div class="news-source">Bitcoin News</div>
                            <div class="news-title">No recent news available. Visit bitcoinmagazine.com or coindesk.com for updates.</div>
                            <div class="news-time">--</div>
                        </div>
                    </div>
                `;
                return;
            }

            newsContainer.innerHTML = news.map(item => `
                <a href="${item.url}" target="_blank" rel="noopener" class="news-item">
                    <div class="news-content">
                        <div class="news-source">${item.source || 'Bitcoin News'}</div>
                        <div class="news-title">${item.title}</div>
                        <div class="news-time">${formatTimeAgo(item.published_at)}</div>
                    </div>
                </a>
            `).join('');
        }

        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);

            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            return `${diffDays}d ago`;
        }

        // ===== Firebase Configuration =====
        // To enable community features, create a Firebase project at https://console.firebase.google.com
        // 1. Create new project -> Enable Realtime Database -> Set rules to allow read/write
        // 2. Get your config from Project Settings -> Your apps -> Add web app
        // 3. Add these values as GitHub secrets: FIREBASE_API_KEY, FIREBASE_PROJECT_ID, etc.
        const firebaseConfig = {
            apiKey: "AIzaSyALcBmJZenOj7ynz3WojsnU4alaPjqBYTI",
            authDomain: "thebitcoinpulse.firebaseapp.com",
            databaseURL: "https://thebitcoinpulse-default-rtdb.firebaseio.com",
            projectId: "thebitcoinpulse",
            storageBucket: "thebitcoinpulse.appspot.com",
            messagingSenderId: "424517573976",
            appId: "1:424517573976:web:a5809a8c2994dd2c52d92d"
        };

        let db = null;
        let firebaseEnabled = false;

        function initFirebase() {
            try {
                if (firebaseConfig.apiKey && firebaseConfig.apiKey !== '' && !firebaseConfig.apiKey.includes('{')) {
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.database();
                    firebaseEnabled = true;
                    console.log('Firebase initialized successfully');
                } else {
                    console.log('Firebase not configured - using local storage fallback');
                }
            } catch (e) {
                console.log('Firebase init error:', e);
            }
        }

        // ===== Daily Comments (Firebase) =====
        function initComments() {
            const container = document.getElementById('comments-container');
            const commentsList = document.getElementById('comments-list');
            const submitBtn = document.getElementById('comment-submit');
            const nameInput = document.getElementById('comment-name');
            const textInput = document.getElementById('comment-text');
            const today = new Date().toISOString().split('T')[0];

            if (!firebaseEnabled) {
                commentsList.innerHTML = `
                    <div class="firebase-setup-notice">
                        <p><strong>Comments require Firebase setup</strong></p>
                        <p style="font-size: 0.85rem; margin-top: 8px;">
                            To enable community features, the site owner needs to configure Firebase.
                            <br>See the <a href="https://github.com/willgaildraud/bitcoin-narrative-generator" target="_blank">README</a> for setup instructions.
                        </p>
                    </div>
                `;
                submitBtn.disabled = true;
                return;
            }

            // Load comments
            db.ref('comments/' + today).orderByChild('timestamp').on('value', (snapshot) => {
                const comments = [];
                snapshot.forEach((child) => {
                    comments.push({ id: child.key, ...child.val() });
                });

                if (comments.length === 0) {
                    commentsList.innerHTML = '<div class="comments-empty">No comments yet. Be the first to share your thoughts!</div>';
                } else {
                    commentsList.innerHTML = comments.reverse().map(c => `
                        <div class="comment-item">
                            <div class="comment-meta">
                                <span class="comment-author">${escapeHtml(c.name)}</span>
                                <span class="comment-time">${formatTimeAgo(c.timestamp)}</span>
                            </div>
                            <div class="comment-text">${escapeHtml(c.text)}</div>
                        </div>
                    `).join('');
                }
            });

            // Submit comment
            submitBtn.addEventListener('click', async () => {
                const name = nameInput.value.trim();
                const text = textInput.value.trim();

                if (!name || !text) {
                    alert('Please enter your name and comment');
                    return;
                }

                if (text.length > 500) {
                    alert('Comment is too long (max 500 characters)');
                    return;
                }

                submitBtn.disabled = true;
                submitBtn.textContent = 'Posting...';

                try {
                    await db.ref('comments/' + today).push({
                        name: name.substring(0, 50),
                        text: text.substring(0, 500),
                        timestamp: Date.now()
                    });

                    nameInput.value = '';
                    textInput.value = '';
                } catch (e) {
                    alert('Error posting comment. Please try again.');
                }

                submitBtn.disabled = false;
                submitBtn.textContent = 'Post Comment';
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ===== Glossary Functions =====
        function initGlossary() {
            const overlay = document.getElementById('glossary-overlay');
            const closeBtn = document.getElementById('glossary-close');
            const openBtn = document.getElementById('open-glossary');
            const searchInput = document.getElementById('glossary-search-input');
            const content = document.getElementById('glossary-content');
            const filterBtns = document.querySelectorAll('.filter-btn');

            let currentFilter = 'all';

            // Open glossary
            openBtn.addEventListener('click', () => {
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
                renderGlossaryItems();
            });

            // Close glossary
            closeBtn.addEventListener('click', closeGlossary);
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) closeGlossary();
            });

            // Escape key to close
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && overlay.classList.contains('active')) {
                    closeGlossary();
                }
            });

            function closeGlossary() {
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }

            // Filter buttons
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.category;
                    renderGlossaryItems();
                });
            });

            // Search
            searchInput.addEventListener('input', () => {
                renderGlossaryItems();
            });

            // Render glossary items
            function renderGlossaryItems() {
                const searchTerm = searchInput.value.toLowerCase();
                const metrics = glossaryData.metrics || {};
                const categories = glossaryData.categories || {};

                let html = '';
                Object.entries(metrics).forEach(([key, metric]) => {
                    // Filter by category
                    if (currentFilter !== 'all' && metric.category !== currentFilter) return;

                    // Filter by search
                    const searchable = (metric.displayName + ' ' + metric.shortDescription + ' ' + metric.fullDescription).toLowerCase();
                    if (searchTerm && !searchable.includes(searchTerm)) return;

                    const categoryInfo = categories[metric.category] || { name: metric.category };

                    html += `
                        <div class="glossary-item" data-metric="${key}">
                            <div class="glossary-item-header">
                                <span class="glossary-item-name">${metric.displayName}</span>
                                <span class="glossary-item-category">${categoryInfo.name}</span>
                            </div>
                            <div class="glossary-item-short">${metric.shortDescription}</div>
                            <div class="glossary-item-full">
                                ${metric.fullDescription}
                                <div class="glossary-item-why">${metric.whyItMatters}</div>
                            </div>
                        </div>
                    `;
                });

                content.innerHTML = html || '<p style="color: var(--text-muted); text-align: center; padding: 20px;">No metrics found</p>';

                // Add click to expand
                content.querySelectorAll('.glossary-item').forEach(item => {
                    item.addEventListener('click', () => {
                        item.classList.toggle('expanded');
                    });
                });
            }

            // Create floating tooltip element
            const tooltip = document.createElement('div');
            tooltip.className = 'floating-tooltip';
            tooltip.style.cssText = `
                position: fixed;
                z-index: 10000;
                max-width: 280px;
                padding: 12px 16px;
                background: #161b22;
                border: 1px solid #30363d;
                border-radius: 8px;
                box-shadow: 0 8px 24px rgba(0,0,0,0.4);
                pointer-events: none;
                opacity: 0;
                transition: opacity 0.2s ease;
            `;
            document.body.appendChild(tooltip);

            // Handle info icon hover for desktop tooltips
            document.querySelectorAll('.info-icon').forEach(icon => {
                const metricKey = icon.dataset.metric;
                const metric = glossaryData.metrics[metricKey];

                if (metric) {
                    // Desktop hover
                    icon.addEventListener('mouseenter', (e) => {
                        if (window.innerWidth > 768) {
                            tooltip.innerHTML = `
                                <div style="font-size: 0.85rem; font-weight: 600; color: #f0f6fc; margin-bottom: 6px;">${metric.displayName}</div>
                                <div style="font-size: 0.75rem; color: #8b949e; line-height: 1.5; margin-bottom: 8px;">${metric.fullDescription}</div>
                                <div style="font-size: 0.7rem; color: #f6851b; font-style: italic;">${metric.whyItMatters}</div>
                            `;

                            const rect = icon.getBoundingClientRect();
                            const tooltipWidth = 280;

                            // Position tooltip above the icon
                            let left = rect.left + (rect.width / 2) - (tooltipWidth / 2);
                            let top = rect.top - 10;

                            // Keep within viewport
                            if (left < 10) left = 10;
                            if (left + tooltipWidth > window.innerWidth - 10) {
                                left = window.innerWidth - tooltipWidth - 10;
                            }

                            tooltip.style.left = left + 'px';
                            tooltip.style.top = 'auto';
                            tooltip.style.bottom = (window.innerHeight - top) + 'px';
                            tooltip.style.width = tooltipWidth + 'px';
                            tooltip.style.opacity = '1';
                        }
                    });

                    icon.addEventListener('mouseleave', () => {
                        tooltip.style.opacity = '0';
                    });

                    // Mobile/tablet click - open glossary
                    icon.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (window.innerWidth <= 768) {
                            overlay.classList.add('active');
                            document.body.style.overflow = 'hidden';
                            searchInput.value = metric.displayName || '';
                            currentFilter = 'all';
                            filterBtns.forEach(b => b.classList.remove('active'));
                            filterBtns[0].classList.add('active');
                            renderGlossaryItems();
                        }
                    });
                }
            });
        }

    </script>
</body>
</html>